#include "vars.txt"

LOGIC__HEADER

#define rfBIRD_DROPPED_YOU rf0
#define rfBIRD_LEFT rf1
#define rfHITTING_THE_GROUND rf2
#define rfFALLEN_IN_HOLE rf3
// unused: rf4
#define rfEGO_STOPPED_ANIMATING rf5
// unused: rf6
#define rfFALLEN_TO_EARTH rf7

#define rvCOUNTDOWN rv0

#define oBIRD o1

if (fROOM_SCRIPT_EXECUTED) {
  load.pic(vROOM_NO);
  draw.pic(vROOM_NO);
  discard.pic(vROOM_NO);
  load.sound(SND_OUCH);
  load.sound(SND_FALLING);
  load.view(8);
  load.view(89);
  load.view(105);
  load.view(103);
  load.view(104);
  if (vPREV_ROOM_NO == ROOM80_IN_MID_AIR) {
    set.view(oEGO, 89);
    animate.obj(oBIRD);
    set.view(oBIRD, 8);
    position(oEGO, 2, 50);
    move.obj(oEGO, 100, 50, 0, rfBIRD_DROPPED_YOU);
    set.priority(oBIRD, 14);
    set.priority(oEGO, 15);
  }
  draw(oEGO);
  show.pic();
}
if (rfBIRD_DROPPED_YOU) {
  reset(rfBIRD_DROPPED_YOU);
  erase(oEGO);
  position(oEGO, 108, 53);
  set.view(oEGO, 105);
  set(fCYCLE_EGO_ANIMATION);
  position(oBIRD, 100, 48);
  draw(oBIRD);
  draw(oEGO);
  move.obj(oBIRD, 130, 48, 2, rfBIRD_LEFT);
  move.obj(oEGO, 108, 107, 4, rfHITTING_THE_GROUND);
  set(f135_UNKNOWN);
  sound(SND_FALLING, fSOUND_END_MARKER_2);
}
#if VERSION_U || VERSION_V
if (!rfHITTING_THE_GROUND && fSOUND_END_MARKER_2 && !rfFALLEN_TO_EARTH) {
  reset(fSOUND_END_MARKER_2);
  sound(SND_FALLING, fSOUND_END_MARKER_2);
}
#endif
if (rfBIRD_LEFT) {
  reset(rfBIRD_LEFT);
  erase(oBIRD);
}
if (rfHITTING_THE_GROUND) {
  stop.sound();
  set(rfFALLEN_TO_EARTH);
  reset(rfHITTING_THE_GROUND);
  program.control();
  release.priority(oEGO);
  set.view(oEGO, 103);
  shake.screen(1);
  print("OUCH");
  sound(SND_OUCH, fSOUND_END_MARKER);
  rvCOUNTDOWN = 18;
}
rvCOUNTDOWN--;
if (fSOUND_END_MARKER) {
  if (rvCOUNTDOWN > 0) {
    reset(fSOUND_END_MARKER);
    sound(SND_OUCH, fSOUND_END_MARKER);
  }
}
if (rvCOUNTDOWN == 1) {
  set.view(oEGO, 104);
  end.of.loop(oEGO, rfEGO_STOPPED_ANIMATING);
}
if (rfEGO_STOPPED_ANIMATING) {
  reset(rfEGO_STOPPED_ANIMATING);
  set.view(oEGO, 0);
  reset(fCYCLE_EGO_ANIMATION);
  player.control();
  reset(fTENSE_SITUATION);
  reset(fPLAYER_NOT_IN_CONTROL);
}
if (said("examine", "hole") || said("look inside", "hole")) {
  if (posn(oEGO, 55, 105, 100, 142)) {
    print("In the depths of the large hole you seem to sense a faint, green glow.");
  }
  else {
    print("Don't be afraid... get closer.");
  }
}
if (fEGO_ON_WATER && !fFALLING) {
  set(fSCRIPTED_MOTION);
  stop.cycling(oEGO);
  set(fFALLING);
  set.priority(oEGO, 5);
  get.posn(oEGO, vTEMP_X, vTEMP_Y);
  vTEMP_Y += 35;
  vTEMP_STEP = 8;
  move.obj.v(oEGO, vTEMP_X, vTEMP_Y, vTEMP_STEP, rfFALLEN_IN_HOLE);
  sound(SND_FALLING, fMISC_END_MARKER);
}
if (rfFALLEN_IN_HOLE) {
  reset(rfFALLEN_IN_HOLE);
  reset(fSCRIPTED_MOTION);
  erase(oEGO);
  new.room(ROOM73_CAVE_CEILING_HOLE);
}
if (vEGO_EDGE_CODE == EDGE_LEFT) {
  new.room(ROOM47_MUSHROOM);
}
if (vEGO_EDGE_CODE == EDGE_BOTTOM) {
  new.room(ROOM33_RAGING_RIVER_SPLIT_BY_BOULDER);
}
return;

LOGIC__FOOTER

#ifndef LOGIC_AS_C
#message 1 "In the depths of the large hole you seem to sense a faint, green glow."
#message 2 "Don't be afraid... get closer."
#message 3 "OUCH"
#endif
