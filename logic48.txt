#include "vars.txt"

LOGIC__HEADER



if (fROOM_SCRIPT_EXECUTED) {
  load.pic(vROOM_NO);
  draw.pic(vROOM_NO);
  discard.pic(vROOM_NO);
  load.sound(SND_OUCH);
  load.sound(SND_FALLING);
  load.view(8);
  load.view(89);
  load.view(105);
  load.view(103);
  load.view(104);
  if (vPREV_ROOM_NO == ROOM80_IN_MID_AIR) {
    set.view(oEGO, 89);
    animate.obj(o1);
    set.view(o1, 8);
    position(oEGO, 2, 50);
    move.obj(oEGO, 100, 50, 0, rf0);
    set.priority(o1, 14);
    set.priority(oEGO, 15);
  }
  draw(oEGO);
  show.pic();
}
if (rf0) {
  reset(rf0);
  erase(oEGO);
  position(oEGO, 108, 53);
  set.view(oEGO, 105);
  set(f98);
  position(o1, 100, 48);
  draw(o1);
  draw(oEGO);
  move.obj(o1, 130, 48, 2, rf1);
  move.obj(oEGO, 108, 107, 4, rf2);
  set(f135);
  sound(SND_FALLING, f198);
}
if (!rf2 && f198 && !rf7) {
  reset(f198);
  sound(SND_FALLING, f198);
}
if (rf1) {
  reset(rf1);
  erase(o1);
}
if (rf2) {
  stop.sound();
  set(rf7);
  reset(rf2);
  program.control();
  release.priority(oEGO);
  set.view(oEGO, 103);
  shake.screen(1);
  print("OUCH");
  sound(SND_OUCH, fSOUND_END_MARKER);
  rv0 = 18;
}
rv0--;
if (fSOUND_END_MARKER) {
  if (rv0 != 0) {
    reset(fSOUND_END_MARKER);
    sound(SND_OUCH, fSOUND_END_MARKER);
  }
}
if (rv0 == 1) {
  set.view(oEGO, 104);
  end.of.loop(oEGO, rf5);
}
if (rf5) {
  reset(rf5);
  set.view(oEGO, 0);
  reset(f98);
  player.control();
  reset(f145);
  reset(f209);
}
if (said("examine", "hole") || said("look inside", "hole")) {
  if (posn(oEGO, 55, 105, 100, 142)) {
    print("In the depths of the large hole you seem to sense a faint, green glow.");
  }
  else {
    print("Don't be afraid... get closer.");
  }
}
if (fEGO_ON_WATER && !f199) {
  set(f95);
  stop.cycling(oEGO);
  set(f199);
  set.priority(oEGO, 5);
  get.posn(oEGO, vTEMP_X, vTEMP_Y);
  vTEMP_Y += 35;
  vTEMP_STEP = 8;
  move.obj.v(oEGO, vTEMP_X, vTEMP_Y, vTEMP_STEP, rf3);
  sound(SND_FALLING, f148);
}
if (rf3) {
  reset(rf3);
  reset(f95);
  erase(oEGO);
  new.room(ROOM73);
}
if (vEGO_EDGE_CODE == EDGE_LEFT) {
  new.room(ROOM47_MUSHROOM);
}
if (vEGO_EDGE_CODE == EDGE_BOTTOM) {
  new.room(ROOM33);
}
return;

LOGIC__FOOTER

