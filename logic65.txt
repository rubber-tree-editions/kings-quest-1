#include "vars.txt"

LOGIC__HEADER



if (fROOM_SCRIPT_EXECUTED) {
  load.pic(vROOM_NO);
  draw.pic(vROOM_NO);
  discard.pic(vROOM_NO);
  load.sound(1);
  load.sound(4);
  load.sound(5);
  if (!f170) {
    load.view(42);
    animate.obj(o1);
    set.view(o1, 42);
    position(o1, 118, 140);
    set.priority(o1, 14);
  }
  if (v87 == 2) {
    load.view(40);
    animate.obj(o2);
    set.view(o2, 40);
    position(o2, 33, 76);
    set.cel(o2, 0);
    stop.cycling(o2);
  }
  LABEL62:
    if (v87 == 0) {
      load.view(40);
      animate.obj(o2);
      set.view(o2, 40);
      position(o2, 33, 76);
      set.cel(o2, 0);
      stop.cycling(o2);
      load.view(41);
      animate.obj(o3);
      set.view(o3, 41);
      position(o3, 41, 61);
      set.priority(o3, 8);
    }
  LABEL99:
    if (v87 == 3) {
      load.view(40);
      animate.obj(o2);
      set.view(o2, 40);
      position(o2, 33, 76);
      set.cel(o2, 5);
      stop.cycling(o2);
    }
  LABEL122:
    if (v87 == 1) {
      load.view(40);
      animate.obj(o2);
      set.view(o2, 40);
      position(o2, 33, 76);
      set.cel(o2, 5);
      stop.cycling(o2);
      load.view(41);
      animate.obj(o3);
      set.view(o3, 41);
      position(o3, 41, 61);
      set.priority(o3, 8);
    }
  LABEL159:
    if (vPREV_ROOM_NO == 80) {
      load.view(105);
      load.view(103);
      load.view(104);
      set.view(oEGO, 105);
      ignore.blocks(oEGO);
      position(oEGO, 80, 45);
      set(f98);
      set(f25);
      program.control();
      move.obj(oEGO, 80, 84, 6, f20);
      v81 = 2;
    }
  LABEL195:
    if (vPREV_ROOM_NO == 28) {
      position(oEGO, 49, 163);
    }
  LABEL206:
    if (!fPROTECTED_BY_SPELL && v81 != 3 && vPREV_ROOM_NO != 80 && !fEGO_INVISIBLE) {
      if (v81 == 2) {
        random(0, 250, v62);
        if (v62 < 180) {
          load.view(43);
          animate.obj(o4);
          set.view(o4, 43);
          v30 = 250;
          v31 = 3;
        }
      }
    }
  LABEL255:
    if (v81 == 1) {
      if (!fPROTECTED_BY_SPELL && !fEGO_INVISIBLE) {
        set(f27);
        load.view(43);
        animate.obj(o4);
        set.view(o4, 43);
        position(o4, 26, 120);
      }
    }
  LABEL285:
    if (!f170) {
      draw(o1);
      stop.update(o1);
    }
  LABEL296:
    draw(o2);
    if (v87 == 1) {
      draw(o3);
    }
  LABEL307:
    ignore.blocks(oEGO);
    observe.blocks(o4);
    draw(oEGO);
    show.pic();
    if (fPROTECTED_BY_SPELL) {
      print("Be thankful that you have a protective spell or the witch may have stuck around to try and catch you!");
    }
  LABEL322:
    if (fEGO_INVISIBLE) {
      print();
    }
  LABEL330:
    if (f27) {
      draw(o4);
      follow.ego(o4, 10, f26);
      print("Surprise!  Surprise!  The wicked witch is home and now she's after you!");
    }
}
LABEL344:
  if (f27 && !f32) {
    set(f32);
    sound(1, f148);
  }
LABEL358:
  if (f75) {
    reset(f75);
    set(f130);
    print("As soon as you entered the house the goat ran away.");
    vSCORE -= 5;
  }
LABEL373:
  if (v81 == 3) {
    if (said("anyword", "witch")) {
      print("The witch is dead.");
    }
  }
LABEL392:
  if (vPREV_ROOM_NO == 80) {
    if (!f20 && !f33 && !f27) {
      sound(5, f198);
      set(f33);
    }
  }
LABEL417:
  if (f198) {
    if (!f20 && !f34) {
      reset(f198);
      reset(f33);
    }
  }
LABEL437:
  v32--;
  if (f20) {
    stop.sound();
    set(f34);
    reset(f20);
    observe.blocks(oEGO);
    set.view(oEGO, 103);
    shake.screen(1);
    print("OUCH!");
    v32 = 20;
    set(f98);
    sound(4, fSOUND_END_MARKER);
  }
LABEL467:
  if (fSOUND_END_MARKER) {
    if (v32 > 0) {
      reset(fSOUND_END_MARKER);
      sound(4, fSOUND_END_MARKER);
    }
  }
LABEL485:
  if (v32 == 1) {
    set.view(oEGO, 104);
    end.of.loop(oEGO, f22);
    print(null);
    player.control();
  }
LABEL501:
  v33--;
  if (f22) {
    reset(f22);
    reset(f98);
    set.view(oEGO, 0);
    v33 = 100;
  }
LABEL519:
  if (v33 == 1) {
    if (f27 || f29) {
      print("With a flash, you hear her joyously exclaim, \"This has made me feel like flying!\"");
      erase(o4);
      reset(f27);
      goto(LABEL547);
    }
    print("Try as you will to escape, your labor will be in vain.");
    LABEL547:
      set(f95);
      stop.cycling(oEGO);
      set(fGAME_OVER);
  }
LABEL553:
  if (f27) {
    distance(oEGO, o4, v34);
    if (v34 == 30 && !f30) {
      set(f30);
      stop.motion(oEGO);
      print("Rats!  She has cast some spell to keep you from escaping!. The witch remarks, \"Oh, how nice of you to come for dinner (cackle, cackle)\"");
    }
    if (f26) {
      reset(f26);
      print("She pokes and pinches you, then states, \"This one is too scrawny, so it's into the cage until you fatten up (smack, yum)!\"");
      erase(oEGO);
      position(oEGO, 80, 80);
      draw(oEGO);
      start.motion(oEGO);
      set(f22);
      set(f25);
    }
  }
LABEL603:
  v30--;
  if (v30 == 0) {
    if (v31 > 0) {
      v31--;
      v30 = 250;
    }
  }
LABEL624:
  if (v30 == 1 && v31 == 3) {
    print("Off in the distance you hear a high, squeaky voice say, \"I can smell someone tasty in my house.\"");
  }
LABEL636:
  if (v30 == 1 && v31 == 2) {
    position(o4, 49, 160);
    draw(o4);
    sound(1, f148);
    set(f29);
    if (posn(oEGO, 105, 1, 158, 166)) {
      move.obj(o4, 26, 120, 2, f21);
      set(f31);
      print("The witch mutters, \"I am going to get my oven ready to cook someone for dinner (yum).\"");
    }
  }
LABEL677:
  if (f29 && !f21 && !f31) {
    v30 = 0;
    v31 = 0;
    if (posn(oEGO, 105, 1, 158, 166) && !f23) {
      wander(o4);
      goto(LABEL775);
    }
    if (!f23) {
      set(f23);
      ignore.blocks(o4);
      follow.ego(o4, 10, f26);
    }
    distance(oEGO, o4, v34);
    if (v34 < 30 && !f30 && !posn(oEGO, 105, 132, 158, 166)) {
      set(f30);
      stop.motion(oEGO);
      print("Rats!  She has cast some spell to keep you from escaping!. The witch remarks, \"Oh, how nice of you to come for dinner (cackle, cackle)\"");
    }
    LABEL755:
      if (f26) {
        reset(f26);
        print("She pokes and pinches you, then states, \"This one is too scrawny, so it's into the cage until you fatten up (smack, yum)!\"");
        reposition.to(oEGO, 80, 80);
        start.motion(oEGO);
        set(f22);
        set(f25);
      }
  }
LABEL775:
  if (f21) {
    if (said("examine", "witch")) {
      print("This ugly old witch is one of the most hideous sights you have ever seen.  I would never trust her.");
    }
    distance(oEGO, o4, v70);
    if (v70 < 15) {
      if (said("shove", "witch") || said("murder", "witch")) {
        erase(o4);
        print("Courageously, you manage to push the witch into the oven where she flashes and melts away into a harmless blob. Congratulations!");
        v81 = 3;
        v30 = 0;
        v31 = 0;
        reset(f29);
        reset(f21);
        vSCORE += 7;
      }
    }
    LABEL842:
      if (v70 > 14) {
        if (said("shove", "witch") || said("murder", "witch")) {
          print("You are in no position to do that!");
        }
      }
    LABEL869:
      if (v30 == 1 && v31 == 3) {
        print("The witch mumbles, \"After I get the oven nice and hot, I will be ready to have someone for dinner (giggle).\"");
      }
    LABEL881:
      if (v30 == 1 && v31 == 2) {
        print("The witch mutters, \"The oven is heating up nicely.  I wonder who will be my dinner guest!\"");
      }
    LABEL893:
      if (v30 == 1 && v31 == 0) {
        v30 = 0;
        v31 = 0;
        print("The witch says, \"My oven is now the perfect temperature. It is time to invite someone for dinner (cackle, cackle)!\"");
        reset(f21);
        reset(f31);
        if (posn(oEGO, 100, 1, 158, 166)) {
          wander(o4);
        }
      }
  }
LABEL927:
  if (!f21) {
    if (f29 || f27) {
      if (said("shove", "witch")) {
        print("You are in no position to do that!");
      }
      if (said("murder", "witch")) {
        print("If I were you, I wouldn't try it!  This witch is mean!");
      }
      LABEL968:
        if (said("examine", "witch")) {
          print("This ugly old witch is one of the most hideous sights you have ever seen.  I would never trust her.");
        }
    }
  }
LABEL980:
  if (v81 != 3) {
    if (!f29 && !f27) {
      if (said("anyword", "witch")) {
        print("There is no witch here...RIGHT NOW!!");
      }
    }
  }
LABEL1010:
  if (f29 || f27) {
    if (said("talk", "witch")) {
      print("Now is not a good time to try and start a conversation!");
    }
    if (said("hello") || said("say", "hello")) {
      print("Now is not a good time to try and start a conversation!");
    }
  }
LABEL1050:
  if (said("open", "cage")) {
    print("It is fastened with a very strong lock.  There is no way for you to open it.");
  }
LABEL1062:
  if (said("examine", "building")) {
    print("The little house is surprisingly neat considering a wicked witch lives here.");
  }
LABEL1074:
  if (posn(oEGO, 23, 89, 55, 100)) {
    if (said("examine", "cupboard") || said("look inside", "cupboard")) {
      if (v87 == 3) {
        print("There is nothing but a bare shelf here.");
      }
      if (v87 == 1) {
        print("Sitting on the shelf is a delicious piece of Swiss cheese.");
      }
      LABEL1120:
        if (v87 == 0 || v87 == 2) {
          print("The cabinet on the wall is rather plain and simple.");
        }
    }
    LABEL1134:
      if (said("open", "cupboard")) {
        if (v87 == 1 || v87 == 3) {
          print("It is already open.");
        }
        if (v87 == 2) {
          start.cycling(o2);
          end.of.loop(o2, f148);
          v87 = 3;
        }
        LABEL1173:
          if (v87 == 0) {
            start.cycling(o2);
            end.of.loop(o2, f24);
            v87 = 1;
            if (!f80) {
              set(f80);
              vSCORE += 2;
            }
          }
      }
    LABEL1200:
      if (said("close", "cupboard")) {
        if (v87 == 0 || v87 == 2) {
          print("It is already closed.");
        }
        if (v87 == 3) {
          reverse.loop(o2, f148);
          v87 = 2;
        }
        LABEL1237:
          if (v87 == 1) {
            reverse.loop(o2, f148);
            erase(o3);
            v87 = 0;
          }
      }
    LABEL1252:
      if (!fCARRYING_SWISS_CHEESE) {
        if (said("get", "swiss cheese")) {
          if (v87 == 1) {
            erase(o3);
            get("cheese");
            set(fCARRYING_SWISS_CHEESE);
            vSCORE += 2;
            print("You pluck the Swiss cheese from the shelf.");
            v87 = 3;
          }
          if (v87 == 0 || v87 == 2) {
            print("I don't see any here.");
          }
        }
        LABEL1304:
          if (said("examine", "swiss cheese")) {
            if (v87 == 0 || v87 == 2) {
              print("I don't see any here.");
            }
            if (v87 == 3) {
              print("I don't see any here.");
            }
            LABEL1337:
              if (v87 == 1) {
                print("Sitting on the shelf is a delicious piece of Swiss cheese.");
              }
          }
      }
  }
LABEL1346:
  if (!posn(oEGO, 23, 89, 55, 100)) {
    if (said("examine", "cupboard")) {
      print("You need to be a little closer for a good look.");
    }
    if (said("open", "cupboard") || said("close", "cupboard")) {
      print("You need to be closer to do that.");
    }
    LABEL1389:
      if (!fCARRYING_SWISS_CHEESE) {
        if (said("examine", "swiss cheese")) {
          print("You cannot see it from here.");
        }
        if (said("get", "swiss cheese")) {
          print("I don't see any here.");
        }
      }
  }
LABEL1420:
  if (f24) {
    reset(f24);
    draw(o3);
  }
LABEL1430:
  if (said("examine", "stove")) {
    if (posn(oEGO, 4, 88, 106, 160)) {
      print("It is an old wood stove, and very hot.  The fire must have been burning for some time.");
      goto(LABEL1457);
    }
    print("You may have seen one in the other room, but I am not sure.");
  }
LABEL1457:
  if (said("examine", "cage")) {
    if (f25) {
      if (vPREV_ROOM_NO == 80) {
        print("This cage will be your new home for the rest of your life.");
      }
      if (vPREV_ROOM_NO == 28) {
        print("You look for a way to escape, but there is none.");
      }
    }
    LABEL1491:
      if (!f25) {
        if (posn(oEGO, 4, 88, 106, 160)) {
          print("It is made from rusty, but strong, iron bars.");
          goto(LABEL1515);
        }
        print("You cannot see it from here.");
      }
  }
LABEL1515:
  if (said("feel", "stove")) {
    if (posn(oEGO, 8, 88, 40, 144)) {
      print("The oven is very, very hot.  Someone must have just put some wood in it.");
      goto(LABEL1542);
    }
    print("You are not close enough to touch it.");
  }
LABEL1542:
  if (said("open", "stove")) {
    if (posn(oEGO, 8, 88, 40, 144)) {
      print("You open the door and see a roaring fire burning in the oven.");
      goto(LABEL1569);
    }
    print("From here it would be rather difficult to open the oven.");
  }
LABEL1569:
  if (posn(oEGO, 105, 88, 158, 160)) {
    if (said("examine", "table")) {
      if (f170) {
        print("It is just a plain, wooden bedside table.");
        goto(LABEL1602);
      }
      print("There is a note lying on top of it.");
    }
    LABEL1602:
      if (said("examine", "bed")) {
        print("The witch's bed looks hard and uncomfortable.");
      }
    LABEL1614:
      if (said("sleep") || said("sleep", "bed") || said("get", "nap")) {
        print("You wouldn't want to sleep on a witch's bed.");
      }
  }
LABEL1638:
  if (!posn(oEGO, 105, 88, 158, 160)) {
    if (said("examine", "table")) {
      print("That is the table where she eats her (gulp) food.");
    }
    if (said("examine", "bed")) {
      print("The bed is not here.");
    }
    LABEL1673:
      if (said("sleep") || said("sleep", "bed") || said("get", "nap")) {
        print("The bed is not here.");
      }
  }
LABEL1697:
  if (said("examine", "window")) {
    if (posn(oEGO, 115, 88, 140, 108)) {
      print("You see the forest outside.");
      goto(LABEL1724);
    }
    print("There is little to see from here.");
  }
LABEL1724:
  if (!f170) {
    if (said("examine", "note")) {
      if (posn(oEGO, 114, 132, 140, 160)) {
        print("It is written in a familiar language.");
        goto(LABEL1758);
      }
      print("Your eyes are not sharp enough to see it from here.");
    }
    LABEL1758:
      if (said("get", "note")) {
        if (posn(oEGO, 114, 132, 140, 160)) {
          start.update(o1);
          erase(o1);
          set(f170);
          get("note");
          print("You grab the note from the table.");
          vSCORE += 2;
          goto(LABEL1796);
        }
        print("You cannot reach it from here.");
      }
  }
LABEL1796:
  if (posn(oEGO, 39, 164, 56, 166)) {
    new.room(28);
  }
LABEL1808:
  return;

LOGIC__FOOTER

