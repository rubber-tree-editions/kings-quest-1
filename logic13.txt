#include "vars.txt"

LOGIC__HEADER

#define rfWOLF_IS_HERE rf0
// unused: rf1
#define rfPROTECTED rf2
#define rfINIT_RANDOMIZER rf3

#define rvWOLF_STEP_SIZE rv0

#define oWOLF o1

if (fROOM_SCRIPT_EXECUTED) {
  load.pic(vROOM_NO);
  draw.pic(vROOM_NO);
  discard.pic(vROOM_NO);
  set.horizon(46);
  if (fGOAT_COMPANION) {
    load.logics(LOGIC103_GOAT);
  }
  if (vROOM_YOU_KILLED_THE_GOAT_IN == vROOM_NO) {
    add.to.pic(62, 0, 0, 83, 142, 0, 0);
  }
  random(0, 250, v62);
  if (v62 < 185) {
    rvWOLF_STEP_SIZE = 4;
    step.size(oWOLF, rvWOLF_STEP_SIZE);
    set(rfINIT_RANDOMIZER);
    load.view(4);
    load.view(96);
    load.sound(SND_VILLAIN);
    animate.obj(oWOLF);
    set.view(oWOLF, 4);
  }
  if (rfINIT_RANDOMIZER) {
    do {
      random(0, 250, v70);
    } while (v70 > 90);
  }
  if (vPREV_ROOM_NO == ROOM20_ALPINE_LAKE || vPREV_ROOM_NO == ROOM4_SERENE_LAKE_EAST) {
    if (fEGO_ON_WATER) {
      set.view(oEGO, 0);
      reset(fCYCLE_EGO_ANIMATION);
      vAQUATIC_ACTIVITY = AQUATICACTIVITY_NONE;
    }
  }
  draw(oEGO);
  show.pic();
}
v70--;
if (v70 == 1) {
  set(rfWOLF_IS_HERE);
  position(oWOLF, 7, 68);
  set(f135_UNKNOWN);
  sound(SND_VILLAIN, fSOUND_END_MARKER);
  draw(oWOLF);
  if (!fGOAT_COMPANION) {
    print("Look out for that wolf -- he can run very fast!   Don't let him catch you!");
    follow.ego(oWOLF, 12, fVILLAIN_GOT_YOU);
  }
  if (fGOAT_COMPANION) {
    wander(oWOLF);
    set(rfPROTECTED);
    print("Look out for that wolf -- he can run very fast!   Don't let him catch you!");
    print("The wolf sees that menacing goat by your side and decides to keep his distance.");
  }
}
if (fSOUND_END_MARKER) {
  reset(fSOUND_END_MARKER);
  reset(f135_UNKNOWN);
}
if (!rfWOLF_IS_HERE) {
  if (said("anyword", "wolf")) {
    print("There's no wolf here.");
  }
}
if (rfWOLF_IS_HERE) {
  if (said("examine", "wolf")) {
    print("Yes, it's a wolf and it's very fast.  Now do something!");
  }
  if (said("murder", "wolf")) {
    print("You don't have time to do that right now!");
  }
  if (said("pet", "wolf") || said("talk", "wolf")) {
    print("Are you crazy?");
  }
  if (said("hello") || said("say", "hello")) {
    print("The wolf is in no mood for conversion.");
  }
}
if (fVILLAIN_GOT_YOU) {
  reset(fVILLAIN_GOT_YOU);
  if (fPROTECTED_BY_SPELL) {
    print("You are very fortunate that your protective spell is still working.");
    wander(oWOLF);
    set(rfPROTECTED);
  }
  if (fEGO_INVISIBLE) {
    print("Fortunately, you are invisible and the wolf can't see you.");
    wander(oWOLF);
    set(rfPROTECTED);
  }
  if (fCARRYING_SHIELD) {
    print("You, fortunately, have the magic shield which will protect you.");
    wander(oWOLF);
    set(rfPROTECTED);
  }
  else {
    program.control();
    print("It seems the wolf caught up with you and is discussing dinner arrangements.");
    erase(oWOLF);
    set.view(oEGO, 96);
    start.cycling(oEGO);
    set(fCYCLE_EGO_ANIMATION);
    set(fGAME_OVER);
  }
}
if (rfPROTECTED && vOBJECT_EDGE_CODE != 0) {
  reset(rfPROTECTED);
  reset(rfWOLF_IS_HERE);
  erase(oWOLF);
}
if (fGAME_OVER) {
  return;
}
if (vEGO_EDGE_CODE == EDGE_HORIZON) {
  new.room(ROOM20_ALPINE_LAKE);
}
if (vEGO_EDGE_CODE == EDGE_RIGHT) {
  new.room(ROOM14_BASE_GOLDEN_EGG_TREE);
}
if (vEGO_EDGE_CODE == EDGE_LEFT) {
  new.room(ROOM12_TOP_OF_WELL);
}
if (vEGO_EDGE_CODE == EDGE_BOTTOM) {
  new.room(ROOM4_SERENE_LAKE_EAST);
}
if (fGOAT_COMPANION) {
  call(LOGIC103_GOAT);
}
return;

LOGIC__FOOTER

