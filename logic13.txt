#include "vars.txt"

LOGIC__HEADER

#define rfWOLF_IS_HERE rf0
// unused: rf1
#define rfPROTECTED rf2
#define rfINIT_RANDOMIZER rf3

#define rvWOLF_STEP_SIZE rv0

#define oWOLF o1

if (fROOM_SCRIPT_EXECUTED) {
  load.pic(vROOM_NO);
  draw.pic(vROOM_NO);
  discard.pic(vROOM_NO);
  #if VERSION_S
    load.sound(SND_WOLF);
    load.sound(SND_WOLF2);
    load.view(114);
  #endif
  set.horizon(46);
  if (fGOAT_COMPANION) {
    load.logics(LOGIC103_GOAT);
  }
  if (vROOM_YOU_KILLED_THE_GOAT_IN == vROOM_NO) {
    add.to.pic(62, 0, 0, 83, 142, 0, 0);
  }
  random(0, 250, vTEMP_RESULT);
  if (vTEMP_RESULT < 185) {
    rvWOLF_STEP_SIZE = 4;
    step.size(oWOLF, rvWOLF_STEP_SIZE);
    set(rfINIT_RANDOMIZER);
    load.view(4);
    load.view(96);
    load.sound(SND_VILLAIN);
    animate.obj(oWOLF);
    set.view(oWOLF, 4);
  }
  if (rfINIT_RANDOMIZER) {
    do {
      random(0, 250, vTEMP_RESULT_2);
    } while (vTEMP_RESULT_2 > 90);
  }
  if (vPREV_ROOM_NO == ROOM20_ALPINE_LAKE || vPREV_ROOM_NO == ROOM4_SERENE_LAKE_EAST) {
    if (fEGO_ON_WATER) {
      set.view(oEGO, 0);
      reset(fCYCLE_EGO_ANIMATION);
      vAQUATIC_ACTIVITY = AQUATICACTIVITY_NONE;
    }
  }
  draw(oEGO);
  show.pic();
}
#if VERSION_S
  rv2--;
  if (rf5 && rv2 > 1) {
    sound(SND_WOLF2, rf5);
  }
  if (rv2 == 1) {
    draw(oWOLF);
    wander(oWOLF);
    set(rf6);
    erase(oEGO);
    set.view(oEGO, 114);
    stop.cycling(oEGO);
    draw(oEGO);
    set(fGAME_OVER);
    reset(rf5);
  }
#endif
vTEMP_RESULT_2--;
if (vTEMP_RESULT_2 == 1) {
  set(rfWOLF_IS_HERE);
  position(oWOLF, 7, 68);
  set(f135_UNKNOWN);
  sound(SND_VILLAIN, fSOUND_END_MARKER);
  draw(oWOLF);
  if (!fGOAT_COMPANION) {
    print("Look out for that wolf -- he can run very fast!   Don't let him catch you!");
    #if VERSION_S
      follow.ego(oWOLF, 9, fVILLAIN_GOT_YOU);
    #else
      follow.ego(oWOLF, 12, fVILLAIN_GOT_YOU);
    #endif
  }
  if (fGOAT_COMPANION) {
    wander(oWOLF);
    set(rfPROTECTED);
    print("Look out for that wolf -- he can run very fast!   Don't let him catch you!");
    print("The wolf sees that menacing goat by your side and decides to keep his distance.");
  }
}
#if VERSION_S
  random(1, 9, rv1);
  if (rfWOLF_IS_HERE && rv1 == 2 && fSOUND_END_MARKER && rv2 <= 0) {
    sound(SND_WOLF, fSOUND_END_MARKER);
  }
#else
  if (fSOUND_END_MARKER) {
    reset(fSOUND_END_MARKER);
    reset(f135_UNKNOWN);
  }
#endif
if (!rfWOLF_IS_HERE) {
    if (said("anyword", "wolf")) {
    print("There's no wolf here.");
  }
}
if (rfWOLF_IS_HERE) {
  if (said("examine", "wolf")) {
    print("Yes, it's a wolf and it's very fast.  Now do something!");
  }
  if (said("murder", "wolf")) {
    print("You don't have time to do that right now!");
  }
  if (said("pet", "wolf") || said("talk", "wolf")) {
    print("Are you crazy?");
  }
  if (said("hello") || said("say", "hello")) {
    print("The wolf is in no mood for conversion.");
  }
}
if (fVILLAIN_GOT_YOU) {
  reset(fVILLAIN_GOT_YOU);
  if (fPROTECTED_BY_SPELL) {
    print("You are very fortunate that your protective spell is still working.");
    wander(oWOLF);
    set(rfPROTECTED);
  }
  else if (fEGO_INVISIBLE) {
    print("Fortunately, you are invisible and the wolf can't see you.");
    wander(oWOLF);
    set(rfPROTECTED);
  }
  else if (fCARRYING_SHIELD) {
    print("You, fortunately, have the magic shield which will protect you.");
    wander(oWOLF);
    set(rfPROTECTED);
  }
  else {
    #if VERSION_S
      stop.motion(oEGO);
    #endif
    program.control();
    #if VERSION_S
      rv2 = 15;
    #endif
    print("It seems the wolf caught up with you and is discussing dinner arrangements.");
    erase(oWOLF);
    set.view(oEGO, 96);
    start.cycling(oEGO);
    #if VERSION_S
      stop.motion(oEGO);
    #endif
    set(fCYCLE_EGO_ANIMATION);
    #if VERSION_S
      sound(SND_WOLF2, rf5);
    #else
      set(fGAME_OVER);
    #endif
  }
}
if (rfPROTECTED && vOBJECT_EDGE_CODE != 0) {
  reset(rfPROTECTED);
  reset(rfWOLF_IS_HERE);
  erase(oWOLF);
}
#if VERSION_S
if (fGAME_OVER || rv2 > 0) {
#else
if (fGAME_OVER) {
#endif
  goto RETURN;
}
if (vEGO_EDGE_CODE == EDGE_HORIZON) {
  new.room(ROOM20_ALPINE_LAKE);
}
if (vEGO_EDGE_CODE == EDGE_RIGHT) {
  new.room(ROOM14_BASE_GOLDEN_EGG_TREE);
}
if (vEGO_EDGE_CODE == EDGE_LEFT) {
  new.room(ROOM12_TOP_OF_WELL);
}
if (vEGO_EDGE_CODE == EDGE_BOTTOM) {
  new.room(ROOM4_SERENE_LAKE_EAST);
}
if (fGOAT_COMPANION) {
  call(LOGIC103_GOAT);
}
RETURN:
  #if VERSION_S
    if (rf5 && rv2 > 1) {
      sound(SND_WOLF2, rf5);
    }
    if (fGAME_OVER && rf6) {
      if (vOBJECT_TOUCHING_EDGE > 0 || vOBJECT_EDGE_CODE > 0) {
        reset(rfWOLF_IS_HERE);
        reset(rf6);
        erase(oWOLF);
      }
    }
  #endif
  return;

LOGIC__FOOTER

#ifndef LOGIC_AS_C
#message 1 "Look out for that wolf -- he can run very fast!   Don't let him catch you!"
#message 2 "You are very fortunate that your protective spell is still working."
#message 3 "Fortunately, you are invisible and the wolf can't see you."
#message 4 "The wolf sees that menacing goat by your side and decides to keep his distance."
#message 5 "You, fortunately, have the magic shield which will protect you."
#message 6 "Yes, it's a wolf and it's very fast.  Now do something!"
#message 7 "You don't have time to do that right now!"
#message 8 "It seems the wolf caught up with you and is discussing dinner arrangements."
#message 9 "Are you crazy?"
#message 10 "There's no wolf here."
#message 11 "Now that the goat is gone, you'll have to take care of yourself!"
#message 12 "The wolf is in no mood for conversion."
#endif
