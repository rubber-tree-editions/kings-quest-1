#include "vars.txt"

LOGIC__HEADER

#define rfFALLING_DOWN_WELL rf0
#define rfFALLEN_DOWN_WELL rf1
#define rfFALLEN_OFF_ROPE rf2
#define rfSWIMMING rf3
#define rfPLAYING_SND_FALLING rf4
#define rfFELL_FROM_ROPE rf5

#define rvCOUNTDOWN rv0

if (fROOM_SCRIPT_EXECUTED) {
  load.pic(vROOM_NO);
  draw.pic(vROOM_NO);
  discard.pic(vROOM_NO);
  load.sound(SND_FALLING);
  load.logics(LOGIC101_SWIMMING);
  call(LOGIC101_SWIMMING);
  load.view(72);
  load.view(16);
  load.view(74);
  load.view(105);
  load.view(99);
  if (f182) {
    set.view(oEGO, 105);
    position(oEGO, 81, 48);
    ignore.objs(oEGO);
    ignore.blocks(oEGO);
    set.priority(oEGO, 15);
    set(fCYCLE_EGO_ANIMATION);
    set(rfFALLING_DOWN_WELL);
    move.obj(oEGO, 81, 164, 3, rfFALLEN_DOWN_WELL);
  }
  if (vPREV_ROOM_NO == ROOM12_TOP_OF_WELL && !f182) {
    if (!f162) {
      set(f162);
      vSCORE += 1;
    }
    if (fON_WELL_ROPE) {
      set.view(oEGO, 74);
      position(oEGO, 81, 48);
      set.priority(oEGO, 15);
    }
  }
  if (vPREV_ROOM_NO == ROOM52_IN_WELL_UNDERWATER) {
    vAQUATIC_ACTIVITY = AQUATICACTIVITY_SWIMMING;
    set.view(oEGO, 70);
    set(rfSWIMMING);
    rvCOUNTDOWN = 250;
    position(oEGO, 75, 163);
  }
  if (f179) {
    add.to.pic(99, 0, 0, 84, 119, 4, 4);
    discard.view(99);
  }
  if (fBUCKET_LOWERED) {
    if (fIN_WELL_BUCKET) {
      animate.obj(o1);
      set.view(o1, 72);
      position(o1, 79, 150);
      set.cel(o1, 0);
      draw(o1);
      add.to.pic(99, 0, 0, 84, 119, 4, 4);
      end.of.loop(o1, f148);
      goto(SHOWPIC);
    }
    add.to.pic(99, 0, 0, 84, 119, 4, 4);
    animate.obj(o1);
    set.view(o1, 16);
    position(o1, 79, 150);
    set.cel(o1, 0);
    draw(o1);
    stop.update(o1);
  }
  draw(oEGO);
  SHOWPIC:
    show.pic();
}
if (fEGO_ON_WATER) {
  observe.blocks(oEGO);
}
else {
  ignore.blocks(oEGO);
}
if (f182 && !rfFALLEN_DOWN_WELL && !rfFALLEN_OFF_ROPE && !rfPLAYING_SND_FALLING) {
  sound(SND_FALLING, fSOUND_END_MARKER);
  set(rfPLAYING_SND_FALLING);
}
if (fSOUND_END_MARKER) {
  if (!rfFALLEN_DOWN_WELL && !rfFALLEN_OFF_ROPE) {
    reset(rfPLAYING_SND_FALLING);
    reset(fSOUND_END_MARKER);
  }
}
if (fON_WELL_ROPE) {
  get.posn(oEGO, vTEMP_X, vTEMP_Y);
  if (vTEMP_Y > 115 && fBUCKET_LOWERED) {
    reset(fON_WELL_ROPE);
    set(f182);
    set.view(oEGO, 105);
    vTEMP_Y = 164;
    ignore.objs(oEGO);
    set.priority(oEGO, 15);
    set(fCYCLE_EGO_ANIMATION);
    set(rfFALLING_DOWN_WELL);
    vTEMP_STEP = 3;
    move.obj.v(oEGO, vTEMP_X, vTEMP_Y, vTEMP_STEP, rfFALLEN_OFF_ROPE);
  }
  if (vTEMP_Y > 115 && f179) {
    reset(fON_WELL_ROPE);
    set(f182);
    set.view(oEGO, 105);
    vTEMP_Y = 164;
    ignore.objs(oEGO);
    set.priority(oEGO, 15);
    set(fCYCLE_EGO_ANIMATION);
    set(rfFALLING_DOWN_WELL);
    vTEMP_STEP = 3;
    move.obj.v(oEGO, vTEMP_X, vTEMP_Y, vTEMP_STEP, rfFALLEN_OFF_ROPE);
  }
  if (vTEMP_X < 79 || vTEMP_X > 83) {
    if (vTEMP_Y > 70) {
      reset(fON_WELL_ROPE);
      set(f182);
      set.view(oEGO, 105);
      vTEMP_Y = 164;
      ignore.objs(oEGO);
      set.priority(oEGO, 15);
      set(fCYCLE_EGO_ANIMATION);
      set(rfFALLING_DOWN_WELL);
      vTEMP_STEP = 3;
      move.obj.v(oEGO, vTEMP_X, vTEMP_Y, vTEMP_STEP, rfFALLEN_OFF_ROPE);
    }
    else {
      reset(fON_WELL_ROPE);
      set(f182);
      set(rfFELL_FROM_ROPE);
      set.view(oEGO, 105);
      vTEMP_Y = 164;
      ignore.objs(oEGO);
      set.priority(oEGO, 15);
      set(fCYCLE_EGO_ANIMATION);
      set(rfFALLING_DOWN_WELL);
      vTEMP_STEP = 3;
      move.obj.v(oEGO, vTEMP_X, vTEMP_Y, vTEMP_STEP, rfFALLEN_DOWN_WELL);
    }
  }
}
if (rfFALLEN_DOWN_WELL) {
  reset(rfFALLEN_DOWN_WELL);
  stop.sound();
  erase(oEGO);
  if (f182 && !rfFELL_FROM_ROPE) {
    print("You should be more careful before trying that next time!");
  }
  else {
    print("I can see you need a little practice climbing rope!");
  }
  set(fGAME_OVER);
}
if (rfFALLEN_OFF_ROPE) {
  reset(rfFALLING_DOWN_WELL);
  reset(rfFALLEN_OFF_ROPE);
  reset(fCYCLE_EGO_ANIMATION);
  reset(f182);
  release.priority(oEGO);
  stop.sound();
  set.view(oEGO, 93);
}
if (vAQUATIC_ACTIVITY == AQUATICACTIVITY_SWIMMING && !rfSWIMMING) {
  set(rfSWIMMING);
  rvCOUNTDOWN = 250;
}
rvCOUNTDOWN--;
if (rvCOUNTDOWN == 1 && rfSWIMMING) {
  erase(oEGO);
  print("Your arms are like lead... from swimming.  You find it impossible... to swim any longer.  You sink to the bottom... of the well....");
  set(fGAME_OVER);
}
if (!fON_WELL_ROPE && !rfFALLING_DOWN_WELL) {
  if (said("climb", "rope") || said("up", "rope")) {
    if (!f179 && !fBUCKET_LOWERED) {
      print("The rope is out of reach.");
    }
    if (f179) {
      erase(oEGO);
      vAQUATIC_ACTIVITY = AQUATICACTIVITY_NONE;
      reset(fCYCLE_EGO_ANIMATION);
      set.view(oEGO, 74);
      position(oEGO, 81, 113);
      set.priority(oEGO, 15);
      draw(oEGO);
      move.obj(oEGO, 81, 113, 0, f148);
      set(fON_WELL_ROPE);
      reset(rfSWIMMING);
    }
    if (fBUCKET_LOWERED && !fIN_WELL_BUCKET) {
      erase(oEGO);
      vAQUATIC_ACTIVITY = AQUATICACTIVITY_NONE;
      reset(fCYCLE_EGO_ANIMATION);
      set.view(oEGO, 74);
      position(oEGO, 81, 113);
      set.priority(oEGO, 15);
      draw(oEGO);
      move.obj(oEGO, 81, 113, 0, f148);
      set(fON_WELL_ROPE);
      reset(rfSWIMMING);
    }
    if (fIN_WELL_BUCKET) {
      start.update(o1);
      erase(o1);
      set.view(o1, 16);
      set.view(oEGO, 74);
      position(o1, 78, 150);
      position(oEGO, 81, 113);
      set.cel(o1, 0);
      draw(o1);
      stop.update(o1);
      set.priority(oEGO, 15);
      draw(oEGO);
      move.obj(oEGO, 81, 113, 0, f148);
      set(fON_WELL_ROPE);
      reset(fIN_WELL_BUCKET);
    }
  }
  if (fIN_WELL_BUCKET) {
    if (said("go", "water")
      || said("exit", "bucket")
      || said("go", "water")
      || said("jump", "water")
    ) {
      start.update(o1);
      erase(o1);
      set.view(o1, 16);
      set.view(oEGO, 105);
      position(o1, 79, 150);
      position(oEGO, 81, 124);
      set(fCYCLE_EGO_ANIMATION);
      move.obj(oEGO, 81, 164, 3, rfFALLEN_OFF_ROPE);
      set.cel(o1, 0);
      draw(o1);
      stop.update(o1);
      set.priority(oEGO, 15);
      draw(oEGO);
      set(fON_WELL_ROPE);
      reset(fIN_WELL_BUCKET);
    }
  }
}
if (said("climb", "well") || said("up", "well")) {
  print("You cannot climb the sides of the well.  They are too steep and slippery.");
}
if (said("examine", "well")) {
  print("When you look upwards, you see the top of the well far, far above.");
}
if (!fCARRYING_BUCKET) {
  if (said("examine", "bucket")) {
    if (fBUCKET_LOWERED) {
      print("Although you can only see the bottom of the bucket, it looks like a very nice bucket.");
    }
    else {
      print("The bucket is not here.");
    }
  }
  if (said("get", "bucket")) {
    if (fBUCKET_LOWERED) {
      print("How are you going to get the bucket?");
    }
    else {
      print("The bucket is not here.");
    }
  }
  if (said("go", "bucket") && fBUCKET_LOWERED && !fIN_WELL_BUCKET) {
    print("I don't think that getting in the bucket right now will do you very much good.");
  }
}
if (said("untie", "rope")) {
  if (fON_WELL_ROPE || fIN_WELL_BUCKET) {
    print("The knot is tied very tightly.");
  }
  else {
    print("The rope is out of reach.");
  }
}
if (said("get", "rope")) {
  if (fON_WELL_ROPE || fIN_WELL_BUCKET) {
    print("The rope is secured to the well with a very tight knot.");
  }
  else {
    print("The rope is out of reach.");
  }
}
if (said("break", "rope")) {
  if (fON_WELL_ROPE || fIN_WELL_BUCKET) {
    print("The thick rope resists your efforts.");
  }
  else {
    print("The rope is out of reach.");
  }
}
if (said("lower", "bucket")
  || said("raise", "bucket")
  || said("lower", "rope")
  || said("raise", "rope")
) {
  print("A person in your position is in no position to raise or lower anything.");
}
if (!fCARRYING_DAGGER) {
  if (said("cut", "rope")) {
    print("You have nothing to cut the rope with.");
  }
}
if (fCARRYING_DAGGER) {
  if (said("cut", "rope")) {
    if (fON_WELL_ROPE && fBUCKET_LOWERED) {
      print("Just before slitting the rope, you realize that it is not a very wise move at this time.");
    }
    if (fIN_WELL_BUCKET) {
      print("Just before slitting the rope, you realize that it is not a very wise move at this time.");
    }
    if (!fBUCKET_LOWERED) {
      print("There is no reason to cut the rope.");
    }
    if (vAQUATIC_ACTIVITY == AQUATICACTIVITY_SWIMMING && fBUCKET_LOWERED) {
      print("You reach up out of the well water and cut the thick rope that holds the bucket.");
      start.update(o1);
      erase(o1);
      set(fCARRYING_BUCKET);
      set(fBUCKET_ROPE_CUT);
      reset(fBUCKET_LOWERED);
      set(f179);
      vSCORE += 2;
      get("water bucket");
      if (fBUCKET_ON_WELL_HAS_WATER) {
        set(fBUCKET_FILLED);
        get("water");
        if (!fFILL_BUCKET_POINTS) {
          set(fFILL_BUCKET_POINTS);
          vSCORE += 2;
        }
      }
    }
    if (vAQUATIC_ACTIVITY == AQUATICACTIVITY_DROWNING) {
      print("You have other things to think about right now.");
    }
    if (!fBUCKET_LOWERED && !f179) {
      print("The rope is out of reach.");
    }
  }
}
if (!fBUCKET_FILLED) {
  if (said("examine", "water")) {
    print("This is murky well water.");
  }
  if (said("drink", "water")) {
    if (vAQUATIC_ACTIVITY == AQUATICACTIVITY_DROWNING || vAQUATIC_ACTIVITY == AQUATICACTIVITY_SWIMMING) {
      print("The water does not taste as good as you expected.");
    }
    else {
      print("You need to be closer to the water to drink.");
    }
  }
  if (said("get", "water")) {
    if (fCARRYING_BUCKET && (
      vAQUATIC_ACTIVITY == AQUATICACTIVITY_DROWNING
      || vAQUATIC_ACTIVITY == AQUATICACTIVITY_SWIMMING
    )) {
      print("In the midst of your activities, you fill the bucket with well water.");
      set(fBUCKET_FILLED);
      if (!fFILL_BUCKET_POINTS) {
        vSCORE += 2;
        set(fFILL_BUCKET_POINTS);
      }
    }
    else {
      print("There is no way for you to get water now.");
    }
  }
}
if (vAQUATIC_ACTIVITY != AQUATICACTIVITY_SWIMMING) {
  if (said("dive", "water") || said("dive", "down") || said("dive")) {
    print("Now is not the time to try diving.");
  }
}
if (vAQUATIC_ACTIVITY == AQUATICACTIVITY_SWIMMING) {
  if (said("dive", "water") || said("dive", "down") || said("dive")) {
    if (!fPOINTS_FOR_DIVING_IN_WELL) {
      set(fPOINTS_FOR_DIVING_IN_WELL);
      vSCORE += 2;
    }
    new.room(ROOM52_IN_WELL_UNDERWATER);
  }
}
if (vEGO_EDGE_CODE == EDGE_HORIZON) {
  new.room(ROOM12_TOP_OF_WELL);
}
call(LOGIC101_SWIMMING);
return;

LOGIC__FOOTER

