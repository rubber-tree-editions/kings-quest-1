#include "vars.txt"

LOGIC__HEADER



if (fROOM_SCRIPT_EXECUTED) {
  load.pic(vROOM_NO);
  draw.pic(vROOM_NO);
  discard.pic(vROOM_NO);
  load.sound(SND_FALLING);
  load.logics(LOGIC_SWIMMING);
  call(LOGIC_SWIMMING);
  load.view(72);
  load.view(16);
  load.view(74);
  load.view(105);
  load.view(99);
  if (f182) {
    set.view(oEGO, 105);
    position(oEGO, 81, 48);
    ignore.objs(oEGO);
    ignore.blocks(oEGO);
    set.priority(oEGO, 15);
    set(f98);
    set(f20);
    move.obj(oEGO, 81, 164, 3, f21);
  }
  if (vPREV_ROOM_NO == 12 && !f182) {
    if (!f162) {
      set(f162);
      vSCORE += 1;
    }
    if (f180) {
      set.view(oEGO, 74);
      position(oEGO, 81, 48);
      set.priority(oEGO, 15);
    }
  }
  if (vPREV_ROOM_NO == 52) {
    v94 = 2;
    set.view(oEGO, 70);
    set(f23);
    v30 = 250;
    position(oEGO, 75, 163);
  }
  if (f179) {
    add.to.pic(99, 0, 0, 84, 119, 4, 4);
    discard.view(99);
  }
  if (f177) {
    if (f181) {
      animate.obj(o1);
      set.view(o1, 72);
      position(o1, 79, 150);
      set.cel(o1, 0);
      draw(o1);
      add.to.pic(99, 0, 0, 84, 119, 4, 4);
      end.of.loop(o1, f148);
      goto(SHOWPIC);
    }
    add.to.pic(99, 0, 0, 84, 119, 4, 4);
    animate.obj(o1);
    set.view(o1, 16);
    position(o1, 79, 150);
    set.cel(o1, 0);
    draw(o1);
    stop.update(o1);
  }
  draw(oEGO);
  SHOWPIC:
    show.pic();
}
if (fEGO_ON_WATER) {
  observe.blocks(oEGO);
}
else {
  ignore.blocks(oEGO);
}
if (f182 && !f21 && !f22 && !f24) {
  sound(SND_FALLING, fSOUND_END_MARKER);
  set(f24);
}
if (fSOUND_END_MARKER) {
  if (!f21 && !f22) {
    reset(f24);
    reset(fSOUND_END_MARKER);
  }
}
if (f180) {
  get.posn(oEGO, vTEMP_X, vTEMP_Y);
  if (vTEMP_Y > 115 && f177) {
    reset(f180);
    set(f182);
    set.view(oEGO, 105);
    vTEMP_Y = 164;
    ignore.objs(oEGO);
    set.priority(oEGO, 15);
    set(f98);
    set(f20);
    vTEMP_STEP = 3;
    move.obj.v(oEGO, vTEMP_X, vTEMP_Y, vTEMP_STEP, f22);
  }
  if (vTEMP_Y > 115 && f179) {
    reset(f180);
    set(f182);
    set.view(oEGO, 105);
    vTEMP_Y = 164;
    ignore.objs(oEGO);
    set.priority(oEGO, 15);
    set(f98);
    set(f20);
    vTEMP_STEP = 3;
    move.obj.v(oEGO, vTEMP_X, vTEMP_Y, vTEMP_STEP, f22);
  }
  if (vTEMP_X < 79 || vTEMP_X > 83) {
    if (vTEMP_Y > 70) {
      reset(f180);
      set(f182);
      set.view(oEGO, 105);
      vTEMP_Y = 164;
      ignore.objs(oEGO);
      set.priority(oEGO, 15);
      set(f98);
      set(f20);
      vTEMP_STEP = 3;
      move.obj.v(oEGO, vTEMP_X, vTEMP_Y, vTEMP_STEP, f22);
    }
    else {
      reset(f180);
      set(f182);
      set(f25);
      set.view(oEGO, 105);
      vTEMP_Y = 164;
      ignore.objs(oEGO);
      set.priority(oEGO, 15);
      set(f98);
      set(f20);
      vTEMP_STEP = 3;
      move.obj.v(oEGO, vTEMP_X, vTEMP_Y, vTEMP_STEP, f21);
    }
  }
}
if (f21) {
  reset(f21);
  stop.sound();
  erase(oEGO);
  if (f182 && !f25) {
    print("You should be more careful before trying that next time!");
  }
  else {
    print("I can see you need a little practice climbing rope!");
  }
  set(fGAME_OVER);
}
if (f22) {
  reset(f20);
  reset(f22);
  reset(f98);
  reset(f182);
  release.priority(oEGO);
  stop.sound();
  set.view(oEGO, 93);
}
if (v94 == 2 && !f23) {
  set(f23);
  v30 = 250;
}
v30--;
if (v30 == 1 && f23) {
  erase(oEGO);
  print("Your arms are like lead... from swimming.  You find it impossible... to swim any longer.  You sink to the bottom... of the well....");
  set(fGAME_OVER);
}
if (!f180 && !f20) {
  if (said("climb", "rope") || said("gingerbread", "rope")) {
    if (!f179 && !f177) {
      print("The rope is out of reach.");
    }
    if (f179) {
      erase(oEGO);
      v94 = 0;
      reset(f98);
      set.view(oEGO, 74);
      position(oEGO, 81, 113);
      set.priority(oEGO, 15);
      draw(oEGO);
      move.obj(oEGO, 81, 113, 0, f148);
      set(f180);
      reset(f23);
    }
    if (f177 && !f181) {
      erase(oEGO);
      v94 = 0;
      reset(f98);
      set.view(oEGO, 74);
      position(oEGO, 81, 113);
      set.priority(oEGO, 15);
      draw(oEGO);
      move.obj(oEGO, 81, 113, 0, f148);
      set(f180);
      reset(f23);
    }
    if (f181) {
      start.update(o1);
      erase(o1);
      set.view(o1, 16);
      set.view(oEGO, 74);
      position(o1, 78, 150);
      position(oEGO, 81, 113);
      set.cel(o1, 0);
      draw(o1);
      stop.update(o1);
      set.priority(oEGO, 15);
      draw(oEGO);
      move.obj(oEGO, 81, 113, 0, f148);
      set(f180);
      reset(f181);
    }
  }
  if (f181) {
    if (said("go", "water")
      || said("exit", "bucket")
      || said("go", "water")
      || said("jump", "water")
    ) {
      start.update(o1);
      erase(o1);
      set.view(o1, 16);
      set.view(oEGO, 105);
      position(o1, 79, 150);
      position(oEGO, 81, 124);
      set(f98);
      move.obj(oEGO, 81, 164, 3, f22);
      set.cel(o1, 0);
      draw(o1);
      stop.update(o1);
      set.priority(oEGO, 15);
      draw(oEGO);
      set(f180);
      reset(f181);
    }
  }
}
if (said("climb", "well") || said("gingerbread", "well")) {
  print("You cannot climb the sides of the well.  They are too steep and slippery.");
}
if (said("examine", "well")) {
  print("When you look upwards, you see the top of the well far, far above.");
}
if (!fCARRYING_BUCKET) {
  if (said("examine", "bucket")) {
    if (f177) {
      print("Although you can only see the bottom of the bucket, it looks like a very nice bucket.");
    }
    else {
      print("The bucket is not here.");
    }
  }
  if (said("get", "bucket")) {
    if (f177) {
      print("How are you going to get the bucket?");
    }
    else {
      print("The bucket is not here.");
    }
  }
  if (said("go", "bucket") && f177 && !f181) {
    print("I don't think that getting in the bucket right now will do you very much good.");
  }
}
if (said("untie", "rope")) {
  if (f180 || f181) {
    print("The knot is tied very tightly.");
  }
  else {
    print("The rope is out of reach.");
  }
}
if (said("get", "rope")) {
  if (f180 || f181) {
    print("The rope is secured to the well with a very tight knot.");
  }
  else {
    print("The rope is out of reach.");
  }
}
if (said("break", "rope")) {
  if (f180 || f181) {
    print("The thick rope resists your efforts.");
  }
  else {
    print("The rope is out of reach.");
  }
}
if (said("lower", "bucket")
  || said("raise", "bucket")
  || said("lower", "rope")
  || said("raise", "rope")
) {
  print("A person in your position is in no position to raise or lower anything.");
}
if (!fCARRYING_DAGGER) {
  if (said("cut", "rope")) {
    print("You have nothing to cut the rope with.");
  }
}
if (fCARRYING_DAGGER) {
  if (said("cut", "rope")) {
    if (f180 && f177) {
      print("Just before slitting the rope, you realize that it is not a very wise move at this time.");
    }
    if (f181) {
      print("Just before slitting the rope, you realize that it is not a very wise move at this time.");
    }
    if (!f177) {
      print("There is no reason to cut the rope.");
    }
    if (v94 == 2 && f177) {
      print("You reach up out of the well water and cut the thick rope that holds the bucket.");
      start.update(o1);
      erase(o1);
      set(fCARRYING_BUCKET);
      set(f176);
      reset(f177);
      set(f179);
      vSCORE += 2;
      get("water bucket");
      if (f163) {
        set(fBUCKET_FILLED);
        get("water");
        if (!fFILL_BUCKET_POINTS) {
          set(fFILL_BUCKET_POINTS);
          vSCORE += 2;
        }
      }
    }
    if (v94 == 1) {
      print("You have other things to think about right now.");
    }
    if (!f177 && !f179) {
      print("The rope is out of reach.");
    }
  }
}
if (!fBUCKET_FILLED) {
  if (said("examine", "water")) {
    print("This is murky well water.");
  }
  if (said("drink", "water")) {
    if (v94 == 1 || v94 == 2) {
      print("The water does not taste as good as you expected.");
    }
    else {
      print("You need to be closer to the water to drink.");
    }
  }
  if (said("get", "water")) {
    if (fCARRYING_BUCKET && (v94 == 1 || v94 == 2)) {
      print("In the midst of your activities, you fill the bucket with well water.");
      set(fBUCKET_FILLED);
      if (!fFILL_BUCKET_POINTS) {
        vSCORE += 2;
        set(fFILL_BUCKET_POINTS);
      }
    }
    else {
      print("There is no way for you to get water now.");
    }
  }
}
if (v94 != 2) {
  if (said("dive", "water") || said("dive", "gingerbread") || said("dive")) {
    print("Now is not the time to try diving.");
  }
}
if (v94 == 2) {
  if (said("dive", "water") || said("dive", "gingerbread") || said("dive")) {
    if (!f164) {
      set(f164);
      vSCORE += 2;
    }
    new.room(52);
  }
}
if (vEGO_EDGE_CODE == EDGE_HORIZON) {
  new.room(12);
}
call(LOGIC_SWIMMING);
return;

LOGIC__FOOTER

