#include "vars.txt"

LOGIC__HEADER



if (fROOM_SCRIPT_EXECUTED) {
  load.pic(vROOM_NO);
  draw.pic(vROOM_NO);
  discard.pic(vROOM_NO);
  load.sound(SND_FALLING);
  load.logics(LOGIC101_SWIMMING);
  call(LOGIC101_SWIMMING);
  load.view(72);
  load.view(16);
  load.view(74);
  load.view(105);
  load.view(99);
  if (f182) {
    set.view(oEGO, 105);
    position(oEGO, 81, 48);
    ignore.objs(oEGO);
    ignore.blocks(oEGO);
    set.priority(oEGO, 15);
    set(f98);
    set(rf0);
    move.obj(oEGO, 81, 164, 3, rf1);
  }
  if (vPREV_ROOM_NO == ROOM12_TOP_OF_WELL && !f182) {
    if (!f162) {
      set(f162);
      vSCORE += 1;
    }
    if (f180) {
      set.view(oEGO, 74);
      position(oEGO, 81, 48);
      set.priority(oEGO, 15);
    }
  }
  if (vPREV_ROOM_NO == ROOM52_IN_WELL_UNDERWATER) {
    vAQUATIC_ACTIVITY = AQUATICACTIVITY_SWIMMING;
    set.view(oEGO, 70);
    set(rf3);
    rv0 = 250;
    position(oEGO, 75, 163);
  }
  if (f179) {
    add.to.pic(99, 0, 0, 84, 119, 4, 4);
    discard.view(99);
  }
  if (fBUCKET_LOWERED) {
    if (f181) {
      animate.obj(o1);
      set.view(o1, 72);
      position(o1, 79, 150);
      set.cel(o1, 0);
      draw(o1);
      add.to.pic(99, 0, 0, 84, 119, 4, 4);
      end.of.loop(o1, f148);
      goto(SHOWPIC);
    }
    add.to.pic(99, 0, 0, 84, 119, 4, 4);
    animate.obj(o1);
    set.view(o1, 16);
    position(o1, 79, 150);
    set.cel(o1, 0);
    draw(o1);
    stop.update(o1);
  }
  draw(oEGO);
  SHOWPIC:
    show.pic();
}
if (fEGO_ON_WATER) {
  observe.blocks(oEGO);
}
else {
  ignore.blocks(oEGO);
}
if (f182 && !rf1 && !rf2 && !rf4) {
  sound(SND_FALLING, fSOUND_END_MARKER);
  set(rf4);
}
if (fSOUND_END_MARKER) {
  if (!rf1 && !rf2) {
    reset(rf4);
    reset(fSOUND_END_MARKER);
  }
}
if (f180) {
  get.posn(oEGO, vTEMP_X, vTEMP_Y);
  if (vTEMP_Y > 115 && fBUCKET_LOWERED) {
    reset(f180);
    set(f182);
    set.view(oEGO, 105);
    vTEMP_Y = 164;
    ignore.objs(oEGO);
    set.priority(oEGO, 15);
    set(f98);
    set(rf0);
    vTEMP_STEP = 3;
    move.obj.v(oEGO, vTEMP_X, vTEMP_Y, vTEMP_STEP, rf2);
  }
  if (vTEMP_Y > 115 && f179) {
    reset(f180);
    set(f182);
    set.view(oEGO, 105);
    vTEMP_Y = 164;
    ignore.objs(oEGO);
    set.priority(oEGO, 15);
    set(f98);
    set(rf0);
    vTEMP_STEP = 3;
    move.obj.v(oEGO, vTEMP_X, vTEMP_Y, vTEMP_STEP, rf2);
  }
  if (vTEMP_X < 79 || vTEMP_X > 83) {
    if (vTEMP_Y > 70) {
      reset(f180);
      set(f182);
      set.view(oEGO, 105);
      vTEMP_Y = 164;
      ignore.objs(oEGO);
      set.priority(oEGO, 15);
      set(f98);
      set(rf0);
      vTEMP_STEP = 3;
      move.obj.v(oEGO, vTEMP_X, vTEMP_Y, vTEMP_STEP, rf2);
    }
    else {
      reset(f180);
      set(f182);
      set(rf5);
      set.view(oEGO, 105);
      vTEMP_Y = 164;
      ignore.objs(oEGO);
      set.priority(oEGO, 15);
      set(f98);
      set(rf0);
      vTEMP_STEP = 3;
      move.obj.v(oEGO, vTEMP_X, vTEMP_Y, vTEMP_STEP, rf1);
    }
  }
}
if (rf1) {
  reset(rf1);
  stop.sound();
  erase(oEGO);
  if (f182 && !rf5) {
    print("You should be more careful before trying that next time!");
  }
  else {
    print("I can see you need a little practice climbing rope!");
  }
  set(fGAME_OVER);
}
if (rf2) {
  reset(rf0);
  reset(rf2);
  reset(f98);
  reset(f182);
  release.priority(oEGO);
  stop.sound();
  set.view(oEGO, 93);
}
if (vAQUATIC_ACTIVITY == AQUATICACTIVITY_SWIMMING && !rf3) {
  set(rf3);
  rv0 = 250;
}
rv0--;
if (rv0 == 1 && rf3) {
  erase(oEGO);
  print("Your arms are like lead... from swimming.  You find it impossible... to swim any longer.  You sink to the bottom... of the well....");
  set(fGAME_OVER);
}
if (!f180 && !rf0) {
  if (said("climb", "rope") || said("up", "rope")) {
    if (!f179 && !fBUCKET_LOWERED) {
      print("The rope is out of reach.");
    }
    if (f179) {
      erase(oEGO);
      vAQUATIC_ACTIVITY = AQUATICACTIVITY_NONE;
      reset(f98);
      set.view(oEGO, 74);
      position(oEGO, 81, 113);
      set.priority(oEGO, 15);
      draw(oEGO);
      move.obj(oEGO, 81, 113, 0, f148);
      set(f180);
      reset(rf3);
    }
    if (fBUCKET_LOWERED && !f181) {
      erase(oEGO);
      vAQUATIC_ACTIVITY = AQUATICACTIVITY_NONE;
      reset(f98);
      set.view(oEGO, 74);
      position(oEGO, 81, 113);
      set.priority(oEGO, 15);
      draw(oEGO);
      move.obj(oEGO, 81, 113, 0, f148);
      set(f180);
      reset(rf3);
    }
    if (f181) {
      start.update(o1);
      erase(o1);
      set.view(o1, 16);
      set.view(oEGO, 74);
      position(o1, 78, 150);
      position(oEGO, 81, 113);
      set.cel(o1, 0);
      draw(o1);
      stop.update(o1);
      set.priority(oEGO, 15);
      draw(oEGO);
      move.obj(oEGO, 81, 113, 0, f148);
      set(f180);
      reset(f181);
    }
  }
  if (f181) {
    if (said("go", "water")
      || said("exit", "bucket")
      || said("go", "water")
      || said("jump", "water")
    ) {
      start.update(o1);
      erase(o1);
      set.view(o1, 16);
      set.view(oEGO, 105);
      position(o1, 79, 150);
      position(oEGO, 81, 124);
      set(f98);
      move.obj(oEGO, 81, 164, 3, rf2);
      set.cel(o1, 0);
      draw(o1);
      stop.update(o1);
      set.priority(oEGO, 15);
      draw(oEGO);
      set(f180);
      reset(f181);
    }
  }
}
if (said("climb", "well") || said("up", "well")) {
  print("You cannot climb the sides of the well.  They are too steep and slippery.");
}
if (said("examine", "well")) {
  print("When you look upwards, you see the top of the well far, far above.");
}
if (!fCARRYING_BUCKET) {
  if (said("examine", "bucket")) {
    if (fBUCKET_LOWERED) {
      print("Although you can only see the bottom of the bucket, it looks like a very nice bucket.");
    }
    else {
      print("The bucket is not here.");
    }
  }
  if (said("get", "bucket")) {
    if (fBUCKET_LOWERED) {
      print("How are you going to get the bucket?");
    }
    else {
      print("The bucket is not here.");
    }
  }
  if (said("go", "bucket") && fBUCKET_LOWERED && !f181) {
    print("I don't think that getting in the bucket right now will do you very much good.");
  }
}
if (said("untie", "rope")) {
  if (f180 || f181) {
    print("The knot is tied very tightly.");
  }
  else {
    print("The rope is out of reach.");
  }
}
if (said("get", "rope")) {
  if (f180 || f181) {
    print("The rope is secured to the well with a very tight knot.");
  }
  else {
    print("The rope is out of reach.");
  }
}
if (said("break", "rope")) {
  if (f180 || f181) {
    print("The thick rope resists your efforts.");
  }
  else {
    print("The rope is out of reach.");
  }
}
if (said("lower", "bucket")
  || said("raise", "bucket")
  || said("lower", "rope")
  || said("raise", "rope")
) {
  print("A person in your position is in no position to raise or lower anything.");
}
if (!fCARRYING_DAGGER) {
  if (said("cut", "rope")) {
    print("You have nothing to cut the rope with.");
  }
}
if (fCARRYING_DAGGER) {
  if (said("cut", "rope")) {
    if (f180 && fBUCKET_LOWERED) {
      print("Just before slitting the rope, you realize that it is not a very wise move at this time.");
    }
    if (f181) {
      print("Just before slitting the rope, you realize that it is not a very wise move at this time.");
    }
    if (!fBUCKET_LOWERED) {
      print("There is no reason to cut the rope.");
    }
    if (vAQUATIC_ACTIVITY == AQUATICACTIVITY_SWIMMING && fBUCKET_LOWERED) {
      print("You reach up out of the well water and cut the thick rope that holds the bucket.");
      start.update(o1);
      erase(o1);
      set(fCARRYING_BUCKET);
      set(fBUCKET_ROPE_CUT);
      reset(fBUCKET_LOWERED);
      set(f179);
      vSCORE += 2;
      get("water bucket");
      if (fBUCKET_ON_WELL_HAS_WATER) {
        set(fBUCKET_FILLED);
        get("water");
        if (!fFILL_BUCKET_POINTS) {
          set(fFILL_BUCKET_POINTS);
          vSCORE += 2;
        }
      }
    }
    if (vAQUATIC_ACTIVITY == AQUATICACTIVITY_DROWNING) {
      print("You have other things to think about right now.");
    }
    if (!fBUCKET_LOWERED && !f179) {
      print("The rope is out of reach.");
    }
  }
}
if (!fBUCKET_FILLED) {
  if (said("examine", "water")) {
    print("This is murky well water.");
  }
  if (said("drink", "water")) {
    if (vAQUATIC_ACTIVITY == AQUATICACTIVITY_DROWNING || vAQUATIC_ACTIVITY == AQUATICACTIVITY_SWIMMING) {
      print("The water does not taste as good as you expected.");
    }
    else {
      print("You need to be closer to the water to drink.");
    }
  }
  if (said("get", "water")) {
    if (fCARRYING_BUCKET && (
      vAQUATIC_ACTIVITY == AQUATICACTIVITY_DROWNING
      || vAQUATIC_ACTIVITY == AQUATICACTIVITY_SWIMMING
    )) {
      print("In the midst of your activities, you fill the bucket with well water.");
      set(fBUCKET_FILLED);
      if (!fFILL_BUCKET_POINTS) {
        vSCORE += 2;
        set(fFILL_BUCKET_POINTS);
      }
    }
    else {
      print("There is no way for you to get water now.");
    }
  }
}
if (vAQUATIC_ACTIVITY != AQUATICACTIVITY_SWIMMING) {
  if (said("dive", "water") || said("dive", "down") || said("dive")) {
    print("Now is not the time to try diving.");
  }
}
if (vAQUATIC_ACTIVITY == AQUATICACTIVITY_SWIMMING) {
  if (said("dive", "water") || said("dive", "down") || said("dive")) {
    if (!fPOINTS_FOR_DIVING_IN_WELL) {
      set(fPOINTS_FOR_DIVING_IN_WELL);
      vSCORE += 2;
    }
    new.room(ROOM52_IN_WELL_UNDERWATER);
  }
}
if (vEGO_EDGE_CODE == EDGE_HORIZON) {
  new.room(ROOM12_TOP_OF_WELL);
}
call(LOGIC101_SWIMMING);
return;

LOGIC__FOOTER

