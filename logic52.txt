#include "vars.txt"

LOGIC__HEADER

if (fROOM_SCRIPT_EXECUTED) {
  load.pic(vROOM_NO);
  draw.pic(vROOM_NO);
  discard.pic(vROOM_NO);
  ignore.horizon(oEGO);
  load.view(73);
  set.view(oEGO, 73);
  load.view(114);
  set(fEGO_ON_WATER);
  if (vPREV_ROOM_NO == 49) {
    position(oEGO, 75, 26);
  }
  else {
    position(oEGO, 38, 116);
  }
  if (vPREV_ROOM_NO == 51) {
    if (!f208) {
      set(f208);
      vSCORE += 2;
    }
  }
  v68 = 250;
  v69 = 3;
  if (fCARRYING_BUCKET && !fBUCKET_FILLED) {
    set(fBUCKET_FILLED);
    get("water");
    if (!fFILL_BUCKET_POINTS) {
      set(fFILL_BUCKET_POINTS);
      vSCORE += 2;
    }
  }
  draw(oEGO);
  show.pic();
  if (fEGO_INVISIBLE) {
    drop("ring");
    vSCORE -= 3;
    print("Thrashing around in the water has caused you to lose the magic ring and become visible again.");
    reset(fCARRYING_RING);
    reset(fEGO_INVISIBLE);
    reset(fWEARING_RING);
    set(fLOST_RING);
    v90 = 0;
    v91 = 0;
  }
}
v68--;
if (v68 == 0) {
  v69--;
  if (v69 > 0) {
    v68 = 250;
  }
}
if (v68 == 0 && v69 == 0 && !f21) {
  set(f21);
  set.view(oEGO, 114);
  print("Not even you can hold your breath forever.  The well bottom has become your eternal resting place.");
  ignore.blocks(oEGO);
  get.posn(oEGO, vTEMP_X, vTEMP_Y);
  if (vTEMP_Y < 141) {
    move.obj(oEGO, 65, 140, 1, f20);
  }
  if (vTEMP_Y > 140) {
    set(f20);
  }
}
if (f20) {
  reset(f20);
  set(fGAME_OVER);
}
if (said("examine", "water")) {
  print("This looks like typical well water.");
}
if (said("examine", "bottle")) {
  print("It looks like this bottle has been here for a very long time.");
}
if (said("get", "bottle")) {
  print("This is just an old, junky bottle.  You don't want it.");
}
if (said("examine", "well")) {
  print("You are at the bottom of th well.  Through the plants you spy what seems to be a hole in the side of the well.");
}
if (said("examine", "hole")) {
  if (posn(oEGO, 1, 75, 65, 166)) {
    print("It is very difficult to tell where the hole might lead.");
  }
  else {
    print("You are too far away to see clearly.");
  }
}
if (said("examine", "can")) {
  print("The rusty old can has been here awhile.");
}
if (said("get", "can")) {
  print("You have no use for this old can.");
}
if (posn(oEGO, 31, 111, 32, 130)) {
  reset(fEGO_ON_WATER);
  new.room(51);
}
if (vEGO_EDGE_CODE == EDGE_HORIZON) {
  new.room(49);
}
return;

LOGIC__FOOTER

