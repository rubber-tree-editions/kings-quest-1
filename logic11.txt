#include "vars.txt"

LOGIC__HEADER

#define oGATE o1
#define oGOAT o13

if (fROOM_SCRIPT_EXECUTED) {
  load.pic(vROOM_NO);
  draw.pic(vROOM_NO);
  discard.pic(vROOM_NO);
  set.horizon(41);
  load.view(15);
  animate.obj(oGATE);
  set.view(oGATE, 15);
  ignore.blocks(oGATE);
  load.view(62);
  load.view(67);
  if (!fGOAT_IS_HERE && vROOM_YOU_KILLED_THE_GOAT_IN <= 0 && !fGOAT_IS_GONE) {
    load.sound(11);
    load.view(14);
    v30 = 27;
    animate.obj(oGOAT);
    set.view(oGOAT, 14);
    observe.blocks(oGOAT);
  }
  if (vROOM_YOU_KILLED_THE_GOAT_IN == vROOM_NO) {
    add.to.pic(62, 0, 0, 56, 122, 9, 0);
  }
  if (!fGOAT_GATE_OPEN) {
    position(oGATE, 17, 156);
    draw(oGATE);
    set(f20);
  }
  if (fGOAT_GATE_OPEN) {
    position(oGATE, 43, 156);
    draw(oGATE);
    stop.update(oGATE);
  }
  if (fGOAT_IS_HERE) {
    set.view(oEGO, 67);
  }
  draw(oEGO);
  show.pic();
}
if (f21 && !fGOAT_IS_HERE) {
  if (!f23) {
    set(f23);
    sound(11, f24);
  }
  if (f24) {
    reset(f23);
    reset(f24);
  }
}
if (posn(oEGO, 16, 153, 44, 155)) {
  set(fINSIDE_GOAT_FENCE);
}
if (posn(oEGO, 16, 156, 44, 158)) {
  reset(fINSIDE_GOAT_FENCE);
}
if (said("examine", "gate")) {
  if (fGOAT_GATE_OPEN) {
    print("The gate is open.");
  }
  else {
    print("The gate is closed.");
  }
}
if (said("open", "gate")) {
  if (f20) {
    if (posn(oEGO, 6, 139, 55, 167)) {
      move.obj(oGATE, 43, 156, 0, fGOAT_GATE_OPEN);
      reset(f20);
      print("The gate is rather heavy, but you manage to open it.");
    }
    else {
      print("You cannot reach the gate from here.");
    }
  }
  if (fGOAT_GATE_OPEN) {
    print("The gate is already open.");
  }
}
if (said("close", "gate")) {
  if (fGOAT_GATE_OPEN && !fGOAT_IS_HERE) {
    if (posn(oEGO, 33, 139, 75, 167)) {
      get.posn(oEGO, v60, v61);
      if (v61 == 156) {
        print("You will have to move out of the way so the gate can close all the way.");
      }
      else {
        print("You find the gate is much easier to close than it was to open.");
      }
      start.update(oGATE);
      move.obj(oGATE, 17, 156, 0, f20);
      reset(fGOAT_GATE_OPEN);
    }
    else {
      print("You cannot reach the gate from here.");
    }
  }
  if (fGOAT_GATE_OPEN && fGOAT_IS_HERE) {
    print("There is no need to close the gate now.");
  }
  if (f20) {
    print("The gate is already closed.");
  }
}
if (!f21) {
  if (said("anyword", "goat")) {
    print("There is no goat here.");
  }
}
v30--;
if (v30 == 1) {
  set(f21);
  position(oGOAT, 4, 100);
  draw(oGOAT);
  wander(oGOAT);
  v30 = 0;
}
if (f21 && !fGOAT_IS_HERE) {
  if (said("hello") || said("hello", "goat") || said("say", "hello") || said("say", "hello", "goat")) {
    print("You get no response from the goat.");
  }
  if (said("examine", "goat")) {
    print("The goat is pacing to and fro.");
  }
  if (said("talk", "goat")) {
    print("The goat refuses to listen to your words.");
  }
  if (said("call", "goat")) {
    print("The old goat refuses to listen to you.");
  }
  if (said("get", "goat")) {
    if (fINSIDE_GOAT_FENCE) {
      print("It would be rather difficult to carry this goat.");
    }
    else {
      print("The old goat's on the other side of the fence!");
    }
  }
  if (said("feed", "goat")) {
    print("What do you want to feed the old goat?");
    set(fSAID_ACCEPTED_USER_INPUT);
  }
  if (!fCARRYING_DAGGER) {
    if (said("murder", "goat")) {
      print("You have no way to accomplish this terrible deed.");
    }
  }
  if (fCARRYING_DAGGER) {
    if (said("murder", "goat")) {
      if (!fINSIDE_GOAT_FENCE) {
        print("From here it will be very difficult to do such a  terrible thing.");
      }
      else {
        erase(oGOAT);
        set.view(oGOAT, 62);
        draw(oGOAT);
        v98 = 0;
        step.size(oGOAT, v98);
        print("You hurl the dagger at the old goat... he tries to avoid the flying dagger, but your aim is true... as the dagger strikes, he slumps to the ground... dead.");
        drop("dagger");
        vSCORE -= 5;
        reset(fCARRYING_DAGGER);
        set(fDAGGER_LOST);
        vROOM_YOU_KILLED_THE_GOAT_IN = vROOM_NO;
      }
    }
  }
  if (said("pet", "goat")) {
    print("You can try, but be careful.");
  }
  if (said("get on", "goat")) {
    if (fINSIDE_GOAT_FENCE) {
      print("Are you kidding?  The goat would never let you!");
    }
    else {
      print("The old goat's on the other side of the fence!");
    }
  }
  if (said("catch", "goat")) {
    if (fINSIDE_GOAT_FENCE) {
      print("The goat will not let you catch him.");
    }
    else {
      print("You cannot do that from outside the fence.");
    }
  }
}
if (vROOM_YOU_KILLED_THE_GOAT_IN == vROOM_NO) {
  if (said("examine", "goat")) {
    print("Lying lifeless on the ground you see a dead goat.");
  }
  if (said("get", "goat")) {
    print("You do not want to carry around a dead goat.");
  }
}
if (said("examine", "goat pen")) {
  print("It is high enough to keep animals inside.");
}
if (said("look inside", "goat pen")) {
  if (f21) {
    print("You see a grey billy goat inside the pen.");
  }
  else {
    print("This looks like an area in which to keep animals.");
  }
}
if (said("jump", "goat pen")) {
  print("The fence is too high for you to jump over.");
}
distance(oEGO, oGOAT, v70);
if (fINSIDE_GOAT_FENCE && f21) {
  if (said("feed", "carrot") || said("feed", "goat", "carrot") || said("feed", "carrot", "goat") || said("give", "carrot") || said("give", "goat", "carrot") || said("give", "carrot", "goat")) {
    if (fCARRYING_CARROT) {
      if (v70 < 25) {
        print("Goats love carrots!  The goat quickly devours yours.");
        vSCORE -= 2;
        drop("carrot");
        reset(fCARRYING_CARROT);
        reset(fPOINTS_FOR_CARROT);
      }
      else {
        print("You are too far away.");
      }
    }
    else {
      print("You do not have a carrot.");
      set(fSAID_ACCEPTED_USER_INPUT);
    }
  }
}
if (fINSIDE_GOAT_FENCE && f21) {
  if (fCARRYING_CARROT && !fGOAT_IS_HERE && !fEGO_INVISIBLE) {
    if (said("show", "carrot") || said("show", "carrot", "goat") || said("show", "goat", "carrot")) {
      if (v70 < 50) {
        if (!f151) {
          print("When you tempt the old goat with the carrot, he starts to follow you.");
          set(fGOAT_IS_HERE);
          erase(oGOAT);
          set.view(oEGO, 67);
          vSCORE += 5;
        }
        if (f151) {
          print("The goat shows some interest in the carrot.");
        }
      }
      else {
        print("You are too far away.");
      }
    }
  }
}
if (!fINSIDE_GOAT_FENCE && f21) {
  if (!fCARRYING_CARROT) {
    if (said("anyword", "carrot")) {
      print("You do not have a carrot.");
    }
  }
  if (fCARRYING_CARROT && !fEGO_INVISIBLE) {
    if (said("feed", "carrot") || said("feed", "goat", "carrot") || said("feed", "carrot", "goat") || said("give", "carrot") || said("give", "goat", "carrot") || said("give", "carrot", "goat")) {
      if (v70 < 25) {
        print("Goats love carrots!  The goat quickly devours yours.");
        vSCORE -= 2;
        drop("carrot");
        reset(fCARRYING_CARROT);
        reset(fPOINTS_FOR_CARROT);
      }
      else {
        print("You are too far away.");
      }
    }
    if (said("show", "carrot") || said("show", "goat", "carrot") || said("show", "carrot", "goat")) {
      if (v70 < 50) {
        print("The goat shows some interest in the carrot.");
      }
      else {
        print("You are too far away.");
      }
    }
  }
}
if (fEGO_INVISIBLE) {
  if (fCARRYING_CARROT && said("anyword", "carrot")) {
    print("Since you are invisible, everything you own is invisible.  The goat cannot see the carrot.");
  }
}
if (vOBJECT_EDGE_CODE == 2 || vOBJECT_EDGE_CODE == 3) {
  if (!fGOAT_IS_HERE) {
    erase(oGOAT);
    reset(f21);
    set(fGOAT_IS_GONE);
    print("It seems the old goat has wandered off.");
  }
}
if (vEGO_EDGE_CODE != 0) {
  if (fGOAT_GATE_OPEN && !fGOAT_IS_HERE && vROOM_YOU_KILLED_THE_GOAT_IN <= 0 && !fGOAT_IS_GONE) {
    set(fGOAT_IS_GONE);
  }
}
if (vEGO_EDGE_CODE == 1) {
  new.room(22);
}
if (vEGO_EDGE_CODE == 2) {
  new.room(12);
}
if (vEGO_EDGE_CODE == 4) {
  new.room(10);
}
if (vEGO_EDGE_CODE == 3) {
  new.room(6);
}
return;

LOGIC__FOOTER

