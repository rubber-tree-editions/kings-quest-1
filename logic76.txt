#include "vars.txt"

LOGIC__HEADER



if (fROOM_SCRIPT_EXECUTED) {
  load.pic(vROOM_NO);
  draw.pic(vROOM_NO);
  discard.pic(vROOM_NO);
  if (vPREV_ROOM_NO == 75) {
    position(oEGO, 113, 146);
  }
  if (vPREV_ROOM_NO == 77) {
    position(oEGO, 73, 163);
  }
  if (fCARRYING_FIDDLE) {
    load.view(50);
    animate.obj(o1);
    set.view(o1, 50);
    position(o1, 96, 78);
    load.sound(SND_FIDDLE_TUNE);
  }
  if (!fDANCING_LEPRECHAUNS) {
    load.view(78);
    load.view(79);
    load.view(80);
    animate.obj(o2);
    animate.obj(o13);
    set.view(o2, 79);
    set.view(o13, 80);
    position(o2, 60, 136);
    position(o13, 45, 119);
    stop.cycling(o13);
    stop.motion(o13);
  }
  if (!fDANCING_LEPRECHAUNS) {
    draw(o13);
    draw(o2);
    if (fCARRYING_CLOVER) {
      wander(o2);
    }
    else {
      follow.ego(o2, 5, f20);
    }
  }
  draw(oEGO);
  show.pic();
  if (!fDANCING_LEPRECHAUNS) {
    if (!fCARRYING_CLOVER && fEGO_INVISIBLE) {
      print("The leprechauns' magic powers detect your unseen presence.");
    }
    if (!fCARRYING_CLOVER && !fEGO_INVISIBLE) {
      print("The leprechauns do not like your invasion of their territory.  They may not let you get any further.");
    }
    if (fCARRYING_CLOVER) {
      print("The leprechauns revere the power of the fourleaf clover. With it in your possession they will leave you absolutely alone.");
    }
  }
}
if (f20) {
  reset(f20);
  print("The leprechaun catches you and holds you with his small,  but strong arms.  I don't think the leprechaun will ever let go.");
  stop.motion(oEGO);
  set(f95);
  stop.cycling(oEGO);
  stop.motion(o2);
  stop.cycling(o2);
  set(fGAME_OVER);
}
if (f22) {
  if (said("play", "fiddle")) {
    print("You are already playing the fiddle.");
  }
}
if (v30 > 0) {
  v30--;
}
if (!fDANCING_LEPRECHAUNS && !f22) {
  if (fCARRYING_FIDDLE && said("play", "fiddle")) {
    set(f21);
    set(f22);
    v30 = 45;
    draw(o1);
    sound(SND_FIDDLE_TUNE, f23);
    start.cycling(o13);
    wander(o13);
    erase(o2);
    set.view(o2, 78);
    draw(o2);
    wander(o2);
    print("Leprechauns love fiddle music!  Have you ever seen such frenzied dancing?");
    set(fDANCING_LEPRECHAUNS);
    vSCORE += 3;
  }
}
if (v30 > 1 && f23) {
  reset(f23);
  sound(SND_FIDDLE_TUNE, f23);
}
if (v30 == 1) {
  v30 = 0;
  stop.sound();
  reset(f21);
  reset(f22);
  erase(o13);
  erase(o2);
  erase(o1);
  print("Totally involved in the music, they dance right out of the room.");
}
if (f21) {
  if (vOBJECT_TOUCHING_EDGE == 13) {
    erase(o13);
  }
  if (vOBJECT_TOUCHING_EDGE == 2) {
    erase(o2);
  }
}
if (said("examine", "room")) {
  if (!fDANCING_LEPRECHAUNS) {
    print("You are in the antechamber of the Hall of the Leprechaun King.  There is a leprechaun in the room with you.");
  }
  else {
    print("You are in the antechamber of the Hall of the Leprechaun King.");
  }
}
if (said("close", "doors")) {
  print("I can think of no good reason to close the door.");
}
if (!fDANCING_LEPRECHAUNS) {
  if (said("examine", "leprechauns")) {
    print("They are tiny people dressed all in green.");
  }
  if (said("talk", "leprechauns") || said("hello") || said("say", "hello")) {
    print("I would not try talking to the leprechauns.  You might say the wrong thing.");
  }
  if (said("murder", "leprechauns")) {
    print("You would not get all of them before they got you.");
  }
}
if (fDANCING_LEPRECHAUNS) {
  if (said("anyword", "leprechauns")) {
    print("There are not any leprechauns here.");
  }
}
if (posn(oEGO, 128, 133, 129, 154)) {
  new.room(75);
}
if (posn(oEGO, 0, 166, 159, 167)) {
  new.room(77);
}
return;

LOGIC__FOOTER

