#include "vars.txt"

LOGIC__HEADER

if (fROOM_SCRIPT_EXECUTED) {
  load.pic(vROOM_NO);
  draw.pic(vROOM_NO);
  discard.pic(vROOM_NO);
  set.horizon(46);
  load.sound(SND_FALLING);
  load.sound(SND_WELL_HANDLE_TURNING);
  if (fGOAT_COMPANION) {
    load.logics(LOGIC103_GOAT);
  }
  if (vROOM_YOU_KILLED_THE_GOAT_IN == vROOM_NO) {
    add.to.pic(62, 0, 0, 107, 81, 0, 0);
  }
  load.view(74);
  load.view(143);
  load.view(18);
  animate.obj(o1);
  set.view(o1, 18);
  position(o1, 66, 96);
  ignore.objs(o1);
  set.priority(o1, 11);
  set.cel(o1, 4);
  if (!fBUCKET_ROPE_CUT) {
    load.view(72);
    load.view(16);
    animate.obj(o2);
    set.view(o2, 16);
    ignore.blocks(o2);
    position(o2, 37, 120);
    set.priority(o2, 11);
    if (!fBUCKET_LOWERED) {
      set.cel(o2, 0);
    }
    if (fBUCKET_LOWERED) {
      set.cel(o2, 7);
    }
  }
  if (!f178) {
    load.view(17);
    animate.obj(o3);
    set.view(o3, 17);
    ignore.blocks(o3);
    position(o3, 43, 147);
    set.priority(o3, 11);
    if (!f179) {
      set.cel(o3, 0);
    }
    if (f179) {
      set.cel(o3, 2);
    }
  }
  if (vPREV_ROOM_NO == ROOM49_INSIDE_WELL) {
    if (fBUCKET_ROPE_CUT) {
      set.view(oEGO, 143);
    }
    else {
      set.view(oEGO, 74);
    }
    set(f180);
    position(oEGO, 38, 140);
    set.priority(oEGO, 11);
    ignore.blocks(oEGO);
    move.obj(oEGO, 38, 140, 0, f148);
  }
  if (vPREV_ROOM_NO == ROOM5_SERENE_LAKE_WEST) {
    if (fEGO_ON_WATER) {
      set.view(oEGO, 0);
      reset(f98);
      vAQUATIC_ACTIVITY = AQUATICACTIVITY_NONE;
    }
  }
  draw(o1);
  stop.update(o1);
  if (!fBUCKET_ROPE_CUT) {
    draw(o2);
    stop.update(o2);
  }
  if (fBUCKET_ROPE_CUT && !f178) {
    draw(o3);
    stop.cycling(o3);
  }
  draw(oEGO);
  show.pic();
}
if (said("examine", "flowers")) {
  print("They raise their colorful faces to the sun.");
}
if (!fCARRYING_BUCKET) {
  if (said("get", "water")) {
    print("All the water is at the bottom of the well.");
  }
}
if (fCARRYING_BUCKET && !fBUCKET_FILLED) {
  if (said("get", "water")) {
    print("Somebody has cut the rope;  there's no way for you to get the bucket to the well's bottom.");
  }
}
if (!fGOAT_COMPANION && !fEGO_INVISIBLE) {
  if (posn(oEGO, 10, 100, 75, 150)) {
    if (fBUCKET_LOWERED || f179) {
      if (said("climb", "rope")
        || said("climb", "well")
        || said("go", "well")
        || said("go down", "well")
        || said("slide", "rope")
      ) {
        erase(oEGO);
        if (fBUCKET_ROPE_CUT) {
          set.view(oEGO, 143);
        }
        else {
          set.view(oEGO, 74);
        }
        position(oEGO, 39, 131);
        draw(oEGO);
        set(f180);
        set.priority(oEGO, 11);
        ignore.blocks(oEGO);
        move.obj(oEGO, 39, 132, 0, f148);
      }
    }
    if (!fBUCKET_LOWERED && !f179) {
      if (said("climb", "well")) {
        print("The sides of this well are too slippery to climb down.");
      }
      if (said("climb", "rope") || said("slide", "rope")) {
        print("The rope does not go down the well very far.");
      }
    }
    if (!fBUCKET_ROPE_CUT && !fBUCKET_LOWERED) {
      if (said("climb", "bucket")
        || said("go", "bucket")
        || said("go", "well")
        || said("go down", "well")
      ) {
        erase(oEGO);
        set.view(o2, 72);
        position(o2, 38, 145);
        set.priority(o2, 11);
        ignore.blocks(o2);
        set.cel(o2, 0);
        start.update(o2);
        erase(o2);
        stop.cycling(o2);
        draw(o2);
        set(f181);
        sound(SND_WELL_HANDLE_TURNING, rf10);
        end.of.loop(o2, rf5);
        start.update(o1);
        start.cycling(o1);
        print("After you are in the old bucket, your weight causes it to slowly descend.");
      }
    }
    if (fBUCKET_LOWERED && !fBUCKET_ROPE_CUT) {
      if (said("climb", "bucket") || said("go", "bucket")) {
        print("The old bucket is at the bottom of the well.");
      }
    }
    if (fBUCKET_ROPE_CUT) {
      if (said("climb", "bucket") || said("go", "bucket")) {
        print("There is no bucket here.");
      }
    }
    if (fBUCKET_ROPE_CUT && !f179) {
      if (said("go", "well") || said("go down", "well")) {
        set(rf6);
        set(rf8);
      }
    }
    if (said("jump", "well")) {
      set(rf7);
      set(rf8);
    }
    if (said("untie", "rope")) {
      print("The knots on the rope are too tight to untie.");
    }
  }
}
if (!posn(oEGO, 10, 100, 75, 150)) {
  if (said("climb", "rope")
    || said("go", "well")
    || said("go down", "well")
    || said("jump", "well")
    || said("slide", "rope")
    || said("go", "bucket")
  ) {
    print("You need to be closer to do that.");
  }
}
if (fGOAT_COMPANION && !fEGO_INVISIBLE) {
  if (posn(oEGO, 10, 100, 75, 150)) {
    if (said("climb", "rope")) {
      print("The goat sure doesn't want to climb the rope.");
    }
    if (said("climb", "well")) {
      print("The goat sure doesn`t want to climb down the well with you.");
    }
    if (said("climb", "bucket")) {
      print("The goat refuses to do down the well.");
    }
    if (said("go", "bucket")) {
      print("That bucket isn't big enough for you and that big goat!");
    }
    if (said("go", "well")) {
      print("The goat refuses to enter the dark well.");
    }
    if (said("go down", "well")) {
      print("The goat refuses to go down into the dark well.");
    }
    if (said("slide", "rope")) {
      print("The goat doesn`t want to slide down the rope.");
    }
    if (said("jump", "well")) {
      print("The goat is afraid of heights and refuses to jump down the well.");
    }
  }
}
if (fEGO_INVISIBLE) {
  if (posn(oEGO, 10, 100, 75, 150)) {
    if (said("climb", "rope")
      || said("go", "bucket")
      || said("go", "well")
      || said("go down", "well")
      || said("slide", "rope")
      || said("jump", "well")
    ) {
      print("You can't do that when you are invisible!");
    }
  }
}
if (f180) {
  get.posn(oEGO, vTEMP_X, vTEMP_Y);
  if (vTEMP_Y < 131) {
    erase(oEGO);
    set.view(oEGO, 0);
    position(oEGO, 48, 111);
    draw(oEGO);
    release.priority(oEGO);
    observe.blocks(oEGO);
    reset(f180);
  }
  if (vTEMP_Y > 145) {
    new.room(ROOM49_INSIDE_WELL);
  }
  if (vTEMP_X < 35 || vTEMP_X > 44) {
    get.posn(oEGO, vTEMP_X, vTEMP_Y);
    vTEMP_Y = 145;
    vTEMP_STEP = 3;
    move.obj.v(oEGO, vTEMP_X, vTEMP_Y, vTEMP_STEP, rf9);
    print("You should be more careful the next time you try  climbing ropes.");
    set(f135);
    sound(SND_FALLING, fSOUND_END_MARKER);
    reset(f180);
  }
}
if (rf9 || rf0) {
  reset(rf9);
  reset(rf0);
  erase(oEGO);
  set(f182);
  new.room(ROOM49_INSIDE_WELL);
}
if (rf8) {
  reset(rf8);
  erase(oEGO);
  position(oEGO, 38, 125);
  set.priority(oEGO, 11);
  ignore.blocks(oEGO);
  draw(oEGO);
  move.obj(oEGO, 38, 145, 3, rf0);
  if (rf6) {
    print("Carefully... Oh no!  The sides were too slippery... you've fallen into the well!");
  }
  if (rf7) {
    print("What a mistake you made!  This well is too deep to jump into.");
  }
  set(f135);
  sound(SND_FALLING, fSOUND_END_MARKER);
}
if (fBUCKET_ROPE_CUT || fBUCKET_LOWERED) {
  if (!fCARRYING_BUCKET && (said("get", "bucket") || said("examine", "bucket"))) {
    print("There is no bucket here.");
  }
}
if (fBUCKET_ROPE_CUT) {
  if (said("lower", "bucket") || said("raise", "bucket")) {
    print("The bucket is not here.");
  }
}
if (!fBUCKET_ROPE_CUT && !fBUCKET_LOWERED) {
  if (!fCARRYING_BUCKET && said("get", "bucket")) {
    if (posn(oEGO, 10, 109, 71, 153)) {
      print("The old bucket is securely fastened to a strong rope.");
    }
    else {
      print("You need to be closer to do that.");
    }
  }
  if (!fCARRYING_BUCKET && said("examine", "bucket")) {
    if (posn(oEGO, 10, 109, 71, 153)) {
      if (fBUCKET_ON_WELL_HAS_WATER) {
        print("The old bucket holds a full load of water.");
      }
      else {
        print("It is large, old and weathered.  It has served the kingdom for many years.");
      }
    }
    else {
      print("From this distance it is difficult to see.");
    }
  }
}
if (!fBUCKET_ROPE_CUT && fBUCKET_LOWERED) {
  if (said("lower", "bucket")) {
    if (posn(oEGO, 10, 109, 71, 153)) {
      print("The old bucket is already at the bottom of the well.");
    }
    else {
      print("You will find that very difficult to do from here.");
    }
  }
}
if (!fBUCKET_ROPE_CUT && !fBUCKET_LOWERED) {
  if (said("raise", "bucket") || said("raise", "rope")) {
    if (posn(oEGO, 10, 109, 71, 153)) {
      print("The bucket is already at the top of the well.");
    }
    else {
      print("You will find that very difficult to do from here.");
    }
  }
}
if (rf1) {
  reset(rf1);
  stop.update(o2);
  stop.update(o1);
}
if (rf2) {
  reset(rf2);
  stop.update(o2);
  stop.update(o1);
}
if (!fBUCKET_ROPE_CUT && !fBUCKET_LOWERED) {
  if (said("lower", "bucket") || said("lower", "rope")) {
    if (posn(oEGO, 60, 108, 77, 140)) {
      print("The old bucket disappears into the darkness.");
      start.update(o2);
      start.update(o1);
      end.of.loop(o2, rf1);
      sound(SND_WELL_HANDLE_TURNING, rf10);
      start.cycling(o1);
      set(fBUCKET_LOWERED);
    }
    else {
      print("You will find that very difficult to do from here.");
    }
  }
}
if (!fBUCKET_ROPE_CUT && fBUCKET_LOWERED && f180) {
  if (said("raise", "bucket")) {
    print("You will find that very difficult to do from here.");
  }
}
if (!fBUCKET_ROPE_CUT && fBUCKET_LOWERED && !f180) {
  if (said("raise", "bucket") || said("raise", "rope")) {
    if (posn(oEGO, 60, 108, 77, 140)) {
      print("The old bucket emerges from the depths of the well.");
      start.update(o2);
      start.update(o1);
      random(0, 250, v62);
      if (v62 < 30) {
        set(fBUCKET_ON_WELL_HAS_WATER);
      }
      reverse.loop(o2, rf2);
      start.cycling(o1);
      sound(SND_WELL_HANDLE_TURNING, rf10);
      reset(fBUCKET_LOWERED);
    }
    else {
      print("You will find that very difficult to do from here.");
    }
  }
}
if (posn(oEGO, 10, 109, 71, 153)) {
  if (said("examine", "well") || said("look inside", "well")) {
    print("The well is deep and dark. But you can see the sky's reflection on the water.");
  }
}
if (!posn(oEGO, 10, 109, 71, 153)) {
  if (said("examine", "well")) {
    print("This well is one of the most ancient sites in the entire kingdom.  History and mystery seem to echo from its  every stone.");
  }
}
if (!f178) {
  if (said("examine", "rope")) {
    if (posn(oEGO, 10, 109, 71, 153)) {
      print("It is thick and firmly attached.  It could easily carry heavy weights.");
    }
    else {
      print("From this distance it is difficult to see.");
    }
  }
}
if (said("get", "rope") && !f178) {
  if (posn(oEGO, 10, 109, 71, 153)) {
    print("The rope is securely fastened to the well.");
  }
  else {
    print("You are not close enough to even try.");
  }
}
if (said("get", "rope") && f178) {
  print("There is no useful rope to get.");
}
if (said("cut", "rope") || said("cut", "rope", "dagger")) {
  if (!fCARRYING_DAGGER) {
    print("You have no way to cut the rope.");
  }
  if (fCARRYING_DAGGER && !posn(oEGO, 10, 109, 71, 153)) {
    print("You will need longer arms to cut that rope from here.");
  }
  if (fCARRYING_DAGGER && posn(oEGO, 10, 109, 71, 153)) {
    if (fBUCKET_ROPE_CUT && !f179) {
      print("You cut a piece of rope and it falls into the well.");
    }
    if (f178) {
      print("There is no useful rope left to cut.");
    }
    if (fBUCKET_ROPE_CUT && f179) {
      erase(o3);
      print("The long piece of rope falls to the bottom of the well.");
      set(f178);
      reset(f179);
    }
    if (!fBUCKET_ROPE_CUT && !fBUCKET_LOWERED) {
      start.update(o2);
      erase(o2);
      draw(o3);
      stop.cycling(o3);
      set(fCARRYING_BUCKET);
      if (fBUCKET_ON_WELL_HAS_WATER) {
        get("water");
        set(fBUCKET_FILLED);
        if (!fFILL_BUCKET_POINTS) {
          vSCORE += 2;
          set(fFILL_BUCKET_POINTS);
        }
      }
      set(fBUCKET_ROPE_CUT);
      get("water bucket");
      print("With the rope cut, you are able to take the bucket.");
      vSCORE += 2;
    }
    if (!fBUCKET_ROPE_CUT && fBUCKET_LOWERED) {
      start.update(o2);
      erase(o2);
      reset(fBUCKET_LOWERED);
      set(fBUCKET_ROPE_CUT);
      set(f178);
      print("The bucket and rope are now at the bottom of the well.");
    }
  }
}
if (f178) {
  if (said("lower", "rope") || said("lower", "bucket")) {
    print("There is not enough rope left to lower.");
  }
}
if (fBUCKET_ROPE_CUT && f179) {
  if (said("lower", "rope")) {
    if (posn(oEGO, 60, 108, 77, 129)) {
      print("The rope has already been lowered.");
    }
    else {
      print("You are not close enough to do that.");
    }
  }
}
if (fBUCKET_ROPE_CUT && !f179) {
  if (said("lower", "rope")) {
    if (posn(oEGO, 60, 108, 77, 129)) {
      start.cycling(o3);
      start.update(o1);
      print("The rope descends into the darkness.");
      sound(SND_WELL_HANDLE_TURNING, rf10);
      end.of.loop(o3, rf4);
      start.cycling(o1);
      set(f179);
    }
    else {
      print("You are not close enough to do that.");
    }
  }
}
if (rf4) {
  reset(rf4);
  stop.update(o1);
  stop.cycling(o3);
}
if (fBUCKET_ROPE_CUT && !f179) {
  if (said("raise", "rope")) {
    if (posn(oEGO, 10, 109, 71, 153)) {
      print("The rope is already at the top of the well.");
    }
    else {
      print("You are not close enough to do that.");
    }
  }
}
if (fBUCKET_ROPE_CUT && f179 && !f180) {
  if (said("raise", "rope")) {
    if (posn(oEGO, 10, 109, 71, 153)) {
      start.cycling(o3);
      start.update(o1);
      print("The rope emerges from the well.");
      reverse.loop(o3, rf3);
      sound(SND_WELL_HANDLE_TURNING, rf10);
      start.cycling(o1);
      reset(f179);
    }
    else {
      print("You are not close enough to do that.");
    }
  }
}
if (rf3) {
  reset(rf3);
  stop.update(o1);
  stop.cycling(o3);
}
if (fBUCKET_ROPE_CUT && f179 && f180) {
  if (said("raise", "rope")) {
    print("You can't raise the rope from here!");
  }
}
if (rf5) {
  reset(rf5);
  set(fBUCKET_LOWERED);
  new.room(ROOM49_INSIDE_WELL);
}
if (vEGO_EDGE_CODE == EDGE_HORIZON) {
  new.room(ROOM21_WITCH_STOMPING_GROUND);
}
if (vEGO_EDGE_CODE == EDGE_RIGHT) {
  new.room(ROOM13_WOLF_STOMPING_GROUND);
}
if (vEGO_EDGE_CODE == EDGE_LEFT) {
  new.room(ROOM11_GOAT_PEN_EAST);
}
if (vEGO_EDGE_CODE == EDGE_BOTTOM) {
  new.room(ROOM5_SERENE_LAKE_WEST);
}
if (fGOAT_COMPANION) {
  call(LOGIC103_GOAT);
}
return;

LOGIC__FOOTER

