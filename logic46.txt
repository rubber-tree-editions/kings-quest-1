#include "vars.txt"

LOGIC__HEADER

#define oOGRE o1

if (fROOM_SCRIPT_EXECUTED) {
  load.pic(vROOM_NO);
  draw.pic(vROOM_NO);
  discard.pic(vROOM_NO);
  if (fGOAT_COMPANION) {
    load.logics(LOGIC103_GOAT);
  }
  if (vROOM_YOU_KILLED_THE_GOAT_IN == vROOM_NO) {
    add.to.pic(62, 0, 0, 60, 71, 0, 0);
  }
  set.horizon(42);
  random(0, 250, v62);
  if (v62 < 175) {
    load.sound(SND_VILLAIN);
    rv1 = 2;
    step.size(oOGRE, rv1);
    load.view(94);
    load.view(95);
    load.view(2);
    animate.obj(oOGRE);
    set.view(oOGRE, 2);
    set(rf0);
  }
  if (rf0) {
    do {
      random(0, 250, v70);
    } while (v70 > 90);
  }
  draw(oEGO);
  show.pic();
}
v70--;
if (v70 == 1) {
  set(f145);
  set(f146);
  position(oOGRE, 40, 51);
  set(rf1);
  set(f135);
  sound(SND_VILLAIN, fSOUND_END_MARKER);
  draw(oOGRE);
  if (!fGOAT_COMPANION) {
    print("Watch out!!!  There is an ogre nearby!  He will crush you in his strong arms if he catches you.");
    follow.ego(oOGRE, 7, f156);
  }
  if (fGOAT_COMPANION) {
    wander(oOGRE);
    set(rf3);
    print("Watch out!!!  There is an ogre nearby!  He will crush you in his strong arms if he catches you.");
    print("Lucky for you that ogres are afraid of goats. This one decides to leave you alone.");
  }
}
if (fSOUND_END_MARKER) {
  reset(fSOUND_END_MARKER);
  reset(f135);
}
if (!rf1) {
  reset(f145);
  reset(f146);
  if (said("anyword", "ogre")) {
    print("There is no ogre here.");
  }
  if (said("throw", "dagger") && fCARRYING_DAGGER) {
    print("OK.  You drop the dagger.");
    reset(fCARRYING_DAGGER);
    set(fDAGGER_LOST);
    drop("dagger");
    vSCORE -= 5;
  }
}
if (f156) {
  reset(f156);
  if (fEGO_INVISIBLE) {
    print("Fortunately, you are invisible and the ogre can't see you.");
    wander(oOGRE);
    set(rf3);
    goto(AFTERCOUNTDOWN);
  }
  if (fPROTECTED_BY_SPELL) {
    print("You are very fortunate that your protective spell is still working.");
    wander(oOGRE);
    set(rf3);
    goto(AFTERCOUNTDOWN);
  }
  if (fCARRYING_SHIELD) {
    print("With the magic shield, no harm will come to you.");
    wander(oOGRE);
    set(rf3);
    goto(AFTERCOUNTDOWN);
  }
  if (fEGO_TINY) {
    print("The ogre's vision is not keen enough to see you.");
    wander(oOGRE);
    set(rf3);
    goto(AFTERCOUNTDOWN);
  }
  set(rf4);
  rv0 = 10;
  program.control();
  stop.motion(oEGO);
  erase(oOGRE);
  set.view(oEGO, 94);
}
rv0--;
AFTERCOUNTDOWN:
  if (rf3 && vOBJECT_EDGE_CODE != 0) {
    erase(oOGRE);
    reset(rf3);
    reset(rf1);
  }
  if (rv0 == 1) {
    print("You were warned to be careful around this fierce creature!  Maybe next time you will be able to elude the beast.");
    get.posn(oEGO, vTEMP_X, vTEMP_Y);
    erase(oEGO);
    set.view(oEGO, 95);
    set.view(oOGRE, 2);
    position.v(oEGO, vTEMP_X, vTEMP_Y);
    position.v(oOGRE, vTEMP_X, vTEMP_Y);
    draw(oOGRE);
    draw(oEGO);
    stop.motion(oOGRE);
    stop.cycling(oOGRE);
    set(fGAME_OVER);
  }
  if (rf1) {
    if (said("examine", "ogre")) {
      print("That is a ferocious looking beast.  Please keep your distance!");
    }
    if (said("murder", "ogre")) {
      print("Ogres are practically indestructible.");
    }
    if (said("examine", "stumps")) {
      print("At one time these were very pretty trees.");
    }
    if (said("pet", "ogre")) {
      print("Do you really want to try that?");
    }
    if (said("examine", "flowers")) {
      print("The delightful wild flowers brighten up your day.");
    }
    if (said("smell", "flowers")) {
      if (posn(oEGO, 22, 86, 114, 167)) {
        print("Their perfume is joyful, sweet, and light.");
      }
      else {
        print("You need to be a little closer to smell the flowers.");
      }
    }
    if (said("talk", "ogre") || said("hello") || said("say", "hello")) {
      print("Ogres don't talk, they growl!");
    }
    if (said("throw", "dagger") && fCARRYING_DAGGER) {
      print("The dagger is of little use against such a mean creature.  I would save it if I were you.");
    }
  }
  if (vEGO_EDGE_CODE != EDGE_NONE) {
    reset(f145);
    reset(f146);
  }
  if (rf4) {
    return;
  }
  if (vEGO_EDGE_CODE == EDGE_HORIZON && rv0 == 0) {
    new.room(ROOM3_ROCK_OVER_HOLE);
  }
  if (vEGO_EDGE_CODE == EDGE_RIGHT && rv0 == 0) {
    new.room(ROOM47_MUSHROOM);
  }
  if (vEGO_EDGE_CODE == EDGE_LEFT && rv0 == 0) {
    new.room(ROOM45_OUTSIDE_WOODCUTTER_COTTAGE_BACK);
  }
  if (vEGO_EDGE_CODE == EDGE_BOTTOM && rv0 == 0) {
    new.room(ROOM35);
  }
  if (fGOAT_COMPANION) {
    call(LOGIC103_GOAT);
  }
  return;

LOGIC__FOOTER
