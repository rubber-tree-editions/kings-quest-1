#include "vars.txt"

LOGIC__HEADER

#define oDOOR o1

if (fROOM_SCRIPT_EXECUTED) {
  load.pic(vROOM_NO);
  draw.pic(vROOM_NO);
  discard.pic(vROOM_NO);
  set.horizon(46);
  if (vWITCH_STATE != WITCHSTATE_DEAD) {
    random(0, 250, v62);
    if (v62 > 125) {
      vWITCH_STATE = WITCHSTATE_AT_HOME;
    }
    else {
      vWITCH_STATE = WITCHSTATE_AWAY_FROM_HOME;
    }
  }
  if (fGOAT_COMPANION) {
    load.logics(LOGIC_GOAT);
  }
  if (vROOM_YOU_KILLED_THE_GOAT_IN == vROOM_NO) {
    add.to.pic(62, 0, 0, 102, 142, 0, 0);
  }
  load.view(23);
  animate.obj(oDOOR);
  set.view(oDOOR, 23);
  set.cel(oDOOR, 0);
  ignore.blocks(oDOOR);
  position(oDOOR, 45, 128);
  load.sound(SND_DOOR_OPENING);
  observe.blocks(oEGO);
  if (vPREV_ROOM_NO == ROOM65) {
    position(oEGO, 48, 132);
  }
  if (vPREV_ROOM_NO == ROOM27) {
    get.posn(oEGO, vTEMP_X, vTEMP_Y);
    if (vTEMP_Y > 94) {
      position(oEGO, 1, 155);
    }
  }
  if (vPREV_ROOM_NO == ROOM37 && fEGO_ON_WATER) {
    set.view(oEGO, 0);
    reset(f98);
    vAQUATIC_ACTIVITY = AQUATICACTIVITY_NONE;
  }
  draw(oDOOR);
  stop.update(oDOOR);
  draw(oEGO);
  show.pic();
}
if (said("examine", "witch")) {
  print("You must be getting nervous!  I see no witch here!");
}
if (said("examine", "window") || said("look inside", "window")) {
  if (posn(oEGO, 66, 120, 92, 134)) {
    print("The windows are made from translucent, hardened sugar.  It's difficult to see through them.");
  }
  else {
    print("You can't see much from here.");
  }
}
if (said("break", "window")) {
  if (posn(oEGO, 66, 120, 92, 134)) {
    print("The windows are hard to break.");
  }
  else {
    print("You would have to get closer to the windows.");
  }
}
if (said("examine", "building")) {
  if (posn(oEGO, 1, 105, 158, 166)) {
    print("This is the sweetest little gingerbread house you ever saw.  The walls are cake, the roof is frosting, the chimney looks delicious, and the candy path and cookie fence are unbearably tempting!");
  }
  else {
    print("You can't see much from here.");
  }
}
if (!posn(oEGO, 20, 120, 110, 135)) {
  if (said("eat", "building") || said("eat", "candy")) {
    print("The house looks tempting, but you need to get closer.");
  }
}
if (posn(oEGO, 20, 120, 110, 135)) {
  if (vWITCH_STATE == WITCHSTATE_AWAY_FROM_HOME || vWITCH_STATE == WITCHSTATE_DEAD) {
    if (said("eat", "building")) {
      print("Yum!  The house tastes even better than it looks!");
      if (!fPOINTS_FOR_EATING_GINGERBREAD_HOUSE) {
        vSCORE += 2;
        set(fPOINTS_FOR_EATING_GINGERBREAD_HOUSE);
      }
    }
    if (said("eat", "candy")) {
      print("Yum!  The house tastes even better than it looks!");
    }
  }
  if (vWITCH_STATE == WITCHSTATE_AT_HOME) {
    if (said("eat", "building")) {
      print("As you begin to eat the house, a squeaky voice from somewhere says, \"Nibble, nibble, little mouse.  Who is nibbling at my house?\"");
      if (!fPOINTS_FOR_EATING_GINGERBREAD_HOUSE) {
        vSCORE += 2;
        set(fPOINTS_FOR_EATING_GINGERBREAD_HOUSE);
      }
    }
    if (said("eat", "candy")) {
      print("As you begin to eat the house, a squeaky voice from somewhere says, \"Nibble, nibble, little mouse.  Who is nibbling at my house?\"");
    }
  }
}
if (posn(oEGO, 40, 127, 70, 135)) {
  if (said("close", "doors")) {
    print("The door is already closed.");
  }
  if (said("knock", "doors")) {
    print("There is no answer from inside the house.");
  }
  if (said("open", "doors")) {
    start.update(oDOOR);
    sound(SND_DOOR_OPENING, f148);
    end.of.loop(oDOOR, f20);
  }
}
if (!posn(oEGO, 40, 127, 70, 135)) {
  if (said("open", "doors") || said("close", "doors") || said("knock", "doors")) {
    print("You will have to move closer to do that.");
  }
}
if (f20) {
  new.room(ROOM65);
}
if (said("examine", "doors")) {
  if (posn(oEGO, 1, 106, 158, 166)) {
    print("The door is made from graham crackers held together  with chocolate drop nails.");
  }
  else {
    print("The door is around the corner.");
  }
}
if (said("break", "doors")) {
  if (posn(oEGO, 1, 106, 158, 166)) {
    print("You don't need to do that; opening the door would suffice.");
  }
  else {
    print("The door is around the corner.");
  }
}
if (said("examine", "fence")) {
  print("It is made of delicious chocolate chip cookies!");
}
if (said("eat", "fence")) {
  if (posn(oEGO, 1, 95, 134, 159)) {
    print("Yummy!");
  }
  else {
    print("You will have to move closer to do that.");
  }
}
if (vEGO_EDGE_CODE == EDGE_HORIZON) {
  new.room(ROOM37);
}
if (vEGO_EDGE_CODE == EDGE_RIGHT) {
  new.room(ROOM29);
}
if (vEGO_EDGE_CODE == EDGE_LEFT) {
  new.room(ROOM27);
}
if (vEGO_EDGE_CODE == EDGE_BOTTOM) {
  new.room(ROOM21_WITCH_STOMPING_GROUND);
}
if (fGOAT_COMPANION) {
  call(LOGIC_GOAT);
}
return;

LOGIC__FOOTER

