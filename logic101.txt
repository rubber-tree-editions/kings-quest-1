#include "vars.txt"

LOGIC__HEADER

if (fROOM_SCRIPT_EXECUTED) {
  load.view(93);
  load.view(70);
  load.sound(13);
  set(f122);
  reset(fSWIMMING);
}
if (f174 || fGAME_OVER) {
  return;
}
if (fSWIMMING_IMPOSSIBLE_HERE && vAQUATIC_ACTIVITY == AQUATICACTIVITY_DROWNING) {
  set(fDROWNING);
  if (said("swim") || said("go", "swim") || said("swim", "anyword") || controller(cSWIM)) {
    if (vROOM_NO == ROOM1 || vROOM_NO == ROOM2) {
      print("Unfortunately, with the moat population swimming is not possible.");
    }
    else {
      print("The swift current does not allow for swimming.");
    }
  }
}
if (vAQUATIC_ACTIVITY == AQUATICACTIVITY_DROWNING) {
  if (!f45) {
    set(f45);
    sound(13, f46);
  }
  if (f46) {
    reset(f46);
    reset(f45);
  }
}
if (fEGO_ON_WATER) {
  if (vAQUATIC_ACTIVITY == AQUATICACTIVITY_NONE) {
    set(f98);
    stop.motion(oEGO);
    v93 = 250;
    vAQUATIC_ACTIVITY = AQUATICACTIVITY_DROWNING;
    if (fMANUAL_EGO_WATER_POS) {
      reposition(oEGO, vEGO_WATER_X, vEGO_WATER_Y);
    }
    else {
      object.on.water(oEGO);
    }
    get.posn(oEGO, vEGO_WATER_X, vEGO_WATER_Y);
    if (vEGO_WATER_X > 139) {
      erase(oEGO);
      set.view(oEGO, 93);
      draw(oEGO);
      if (fEGO_TINY) {
        reset(fEGO_TINY);
        v82 = 0;
        print("It appears you have become normal size again.");
      }
      if (fEGO_INVISIBLE) {
        v90 = 0;
        v91 = 0;
        reset(fEGO_INVISIBLE);
        reset(fCARRYING_RING);
        reset(fWEARING_RING);
        set(fLOST_RING);
        drop("ring");
        vSCORE -= 3;
        print("Thrashing around in the water has caused you to lose the magic ring and become visible again.");
      }
    }
    else {
      set.view(oEGO, 93);
      if (fEGO_TINY) {
        reset(fEGO_TINY);
        v82 = 0;
        print("It appears you have become normal size again.");
      }
      if (fEGO_INVISIBLE) {
        v90 = 0;
        v91 = 0;
        reset(fEGO_INVISIBLE);
        reset(fCARRYING_RING);
        reset(fWEARING_RING);
        set(fLOST_RING);
        drop("ring");
        vSCORE -= 3;
        print("Thrashing around in the water has caused you to lose the magic ring and become visible again.");
      }
    }
    if (fSWIMMING_IMPOSSIBLE_HERE) {
      vDROWN_GAME_OVER_COUNTDOWN = 50;
    }
  }
  else if (!fSWIMMING_IMPOSSIBLE_HERE && vAQUATIC_ACTIVITY != AQUATICACTIVITY_SWIMMING && !fDROWNING) {
    if (said("swim") || said("go", "swim") || said("swim", "anyword") || controller(cSWIM)) {
      set.view(oEGO, 70);
      start.motion(oEGO);
      stop.sound();
      vAQUATIC_ACTIVITY = AQUATICACTIVITY_SWIMMING;
      return;
    }
  }
}
if (!fSWIMMING && !fDROWNING) {
  if (said("swim") || said("go", "swim") || said("swim", "anyword") || controller(cSWIM)) {
    set(fSWIMMING);
    if (!fEGO_ON_WATER) {
      print("You need to be in the water in order to swim.");
    }
    else if (fEGO_ON_WATER && vAQUATIC_ACTIVITY == AQUATICACTIVITY_SWIMMING) {
      print("You are already swimming!");
    }
  }
}
else if (!controller(cSWIM)) {
  reset(fSWIMMING);
}
if (vAQUATIC_ACTIVITY == AQUATICACTIVITY_DROWNING && vDROWN_GAME_OVER_COUNTDOWN <= 0) {
  if (v93 == 0) {
    set(fDROWNING);
    print("You splash around in the water for a while but seem  to have forgotten how to swim. Unfortunately, you drown.");
    vDROWN_GAME_OVER_COUNTDOWN = 50;
  }
  else {
    v93--;
  }
}
if (!fEGO_ON_WATER && vAQUATIC_ACTIVITY == AQUATICACTIVITY_SWIMMING) {
  reset(f98);
  vAQUATIC_ACTIVITY = AQUATICACTIVITY_NONE;
  set.view(oEGO, 0);
  if (f136) {
    reposition(oEGO, vEGO_WATER_X, vEGO_WATER_Y);
  }
  else {
    object.on.land(oEGO);
  }
}
reset(fMANUAL_EGO_WATER_POS);
reset(f136);
vEGO_WATER_X = 0;
vEGO_WATER_Y = 0;
vDROWN_GAME_OVER_COUNTDOWN--;
if (vDROWN_GAME_OVER_COUNTDOWN == 1) {
  erase(oEGO);
  stop.sound();
  set(fGAME_OVER);
}
return;

LOGIC__FOOTER

