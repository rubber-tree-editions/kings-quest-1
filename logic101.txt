#include "vars.txt"

LOGIC__HEADER



if (fROOM_SCRIPT_EXECUTED) {
  load.view(93);
  load.view(70);
  load.sound(13);
  set(f122);
  reset(f147);
}
if (f174 || fGAME_OVER) {
  goto(LABEL474);
}
LABEL29:
  if (f68 && v94 == 1) {
    set(f44);
    if (said("swim") || said("go", "swim") || said("swim", "anyword") || controller(cSWIM)) {
      if (vROOM_NO == 1 || vROOM_NO == 2) {
        print("Unfortunately, with the moat population swimming is not possible.");
        goto(LABEL83);
      }
      print("The swift current does not allow for swimming.");
    }
  }
LABEL83:
  if (v94 == 1) {
    if (!f45) {
      set(f45);
      sound(13, f46);
    }
    if (f46) {
      reset(f46);
      reset(f45);
    }
  }
LABEL112:
  if (fEGO_ON_WATER) {
    if (v94 == 0) {
      set(f98);
      stop.motion(oEGO);
      v93 = 250;
      v94 = 1;
      if (f134) {
        reposition(oEGO, v76, v77);
        goto(LABEL150);
      }
      object.on.water(oEGO);
      LABEL150:
        get.posn(oEGO, v76, v77);
        if (v76 > 139) {
          erase(oEGO);
          set.view(oEGO, 93);
          draw(oEGO);
          if (fEGO_TINY) {
            reset(fEGO_TINY);
            v82 = 0;
            print("It appears you have become normal size again.");
          }
          if (fEGO_INVISIBLE) {
            v90 = 0;
            v91 = 0;
            reset(fEGO_INVISIBLE);
            reset(fCARRYING_RING);
            reset(fWEARING_RING);
            set(fLOST_RING);
            drop("ring");
            vSCORE -= 3;
            print("Thrashing around in the water has caused you to lose the magic ring and become visible again.");
          }
          LABEL208:
            goto(LABEL254);
        }
      LABEL211:
        set.view(oEGO, 93);
        if (fEGO_TINY) {
          reset(fEGO_TINY);
          v82 = 0;
          print("It appears you have become normal size again.");
        }
        if (fEGO_INVISIBLE) {
          v90 = 0;
          v91 = 0;
          reset(fEGO_INVISIBLE);
          reset(fCARRYING_RING);
          reset(fWEARING_RING);
          set(fLOST_RING);
          drop("ring");
          vSCORE -= 3;
          print("Thrashing around in the water has caused you to lose the magic ring and become visible again.");
        }
      LABEL254:
        if (f68) {
          v95 = 50;
        }
      LABEL263:
        goto(LABEL316);
    }
    if (!f68 && v94 != 2 && !f44) {
      if (said("swim") || said("go", "swim") || said("swim", "anyword") || controller(cSWIM)) {
        set.view(oEGO, 70);
        start.motion(oEGO);
        stop.sound();
        v94 = 2;
        goto(LABEL474);
      }
    }
  }
LABEL316:
  if (!f147 && !f44) {
    if (said("swim") || said("go", "swim") || said("swim", "anyword") || controller(cSWIM)) {
      set(f147);
      if (!fEGO_ON_WATER) {
        print("You need to be in the water in order to swim.");
        goto(LABEL375);
      }
      if (fEGO_ON_WATER && v94 == 2) {
        print("You are already swimming!");
      }
    }
    LABEL375:
      goto(LABEL387);
  }
  if (!controller(cSWIM)) {
    reset(f147);
  }
LABEL387:
  if (v94 == 1 && v95 <= 0) {
    if (v93 == 0) {
      set(f44);
      print("You splash around in the water for a while but seem  to have forgotten how to swim. Unfortunately, you drown.");
      v95 = 50;
      goto(LABEL417);
    }
    v93--;
  }
LABEL417:
  if (!fEGO_ON_WATER && v94 == 2) {
    reset(f98);
    v94 = 0;
    set.view(oEGO, 0);
    if (f136) {
      reposition(oEGO, v76, v77);
      goto(LABEL450);
    }
    object.on.land(oEGO);
  }
LABEL450:
  reset(f134);
  reset(f136);
  v76 = 0;
  v77 = 0;
  v95--;
  if (v95 == 1) {
    erase(oEGO);
    stop.sound();
    set(fGAME_OVER);
  }
LABEL474:
  return;

LOGIC__FOOTER

