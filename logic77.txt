#include "vars.txt"

LOGIC__HEADER

#define oSHIELD o1
#define oLEPRECHAUN o2
#define oSCEPTRE o3
#define oLEPRECHAUN_KING o16

if (fROOM_SCRIPT_EXECUTED) {
  set.horizon(58);
  load.pic(vROOM_NO);
  draw.pic(vROOM_NO);
  discard.pic(vROOM_NO);
  if (vPREV_ROOM_NO == 76) {
    position(oEGO, 87, 67);
  }
  if (vPREV_ROOM_NO == 78) {
    position(oEGO, 9, 95);
  }
  if (!fSHIELD_TAKEN) {
    load.view(49);
  }
  if (!fSCEPTRE_TAKEN) {
    load.view(48);
  }
  if (!fDANCING_LEPRECHAUNS) {
    load.sound(21);
    load.view(47);
    load.view(79);
  }
  if (!f187) {
    load.view(81);
    load.view(54);
  }
  if (!fDANCING_LEPRECHAUNS) {
    add.to.pic(79, 1, 0, 94, 156, 14, 0);
    add.to.pic(79, 1, 0, 120, 156, 14, 0);
    add.to.pic(79, 1, 0, 106, 144, 13, 0);
    add.to.pic(79, 1, 0, 128, 156, 14, 0);
    add.to.pic(79, 1, 0, 111, 78, 7, 0);
    add.to.pic(79, 0, 0, 57, 72, 7, 0);
    add.to.pic(79, 0, 0, 45, 77, 7, 0);
    add.to.pic(79, 0, 0, 36, 88, 8, 0);
    add.to.pic(79, 0, 0, 16, 140, 12, 0);
    add.to.pic(79, 0, 0, 30, 150, 13, 0);
  }
  if (!f187) {
    animate.obj(oLEPRECHAUN_KING);
    set.view(oLEPRECHAUN_KING, 54);
    position(oLEPRECHAUN_KING, 121, 98);
    set.priority(oLEPRECHAUN_KING, 10);
    ignore.blocks(oLEPRECHAUN_KING);
    draw(oLEPRECHAUN_KING);
    if (fDANCING_LEPRECHAUNS) {
      set(f20);
      v30 = 27;
    }
  }
  if (!fDANCING_LEPRECHAUNS) {
    animate.obj(oLEPRECHAUN);
    set.view(oLEPRECHAUN, 47);
    position(oLEPRECHAUN, 56, 108);
    if (!fCARRYING_CLOVER) {
      set(f21);
      follow.ego(oLEPRECHAUN, 5, f22);
    }
    else {
      wander(oLEPRECHAUN);
    }
    ignore.blocks(oLEPRECHAUN);
    draw(oLEPRECHAUN);
  }
  if (!fSHIELD_TAKEN) {
    animate.obj(oSHIELD);
    set.view(oSHIELD, 49);
    position(oSHIELD, 131, 128);
    draw(oSHIELD);
  }
  if (f187 && !fSCEPTRE_TAKEN) {
    animate.obj(oSCEPTRE);
    set.view(oSCEPTRE, 48);
    position(oSCEPTRE, 115, 106);
    draw(oSCEPTRE);
  }
  draw(oEGO);
  show.pic();
}
if (!fDANCING_LEPRECHAUNS) {
  if (!f26) {
    set(f26);
    sound(21, f27);
  }
  if (f27) {
    reset(f26);
    reset(f27);
  }
}
if (!fDANCING_LEPRECHAUNS && fCARRYING_CLOVER) {
  observe.blocks(oEGO);
  if (posn(oEGO, 80, 110, 139, 141)) {
    if (!f25) {
      print("The King's magic prevents you from getting close enough to harm him.");
      set(f25);
    }
  }
}
if (fDANCING_LEPRECHAUNS && !f187) {
  ignore.blocks(oEGO);
  if (posn(oEGO, 31, 110, 158, 98)) {
    if (!f25) {
      print("The King's magic prevents you from getting close enough to harm him.");
      set(f25);
    }
  }
}
if (fDANCING_LEPRECHAUNS && f187) {
  ignore.blocks(oEGO);
}
v30--;
if (f20 && v30 == 1) {
  v30 = 0;
  erase(oLEPRECHAUN_KING);
  set.view(oLEPRECHAUN_KING, 81);
  position(oLEPRECHAUN_KING, 115, 117);
  set.loop(oLEPRECHAUN_KING, 1);
  draw(oLEPRECHAUN_KING);
  move.obj(oLEPRECHAUN_KING, 33, 114, 0, f23);
  animate.obj(oSCEPTRE);
  set.view(oSCEPTRE, 48);
  position(oSCEPTRE, 115, 106);
  draw(oSCEPTRE);
  print("After his followers have danced away, the King of the leprechauns realizes he can lead best by following, and leaves, forgetting his beautiful sceptre.");
}
if (f23) {
  reset(f23);
  move.obj(oLEPRECHAUN_KING, 5, 85, 0, f24);
}
if (f24) {
  set(f187);
  reset(f20);
  reset(f24);
  erase(oLEPRECHAUN_KING);
}
if (f21) {
  reset(f21);
  print("I hope you can escape from the leprechauns, but it doesn't look good for you.");
}
if (f22) {
  reset(f22);
  print("The leprechaun, with much support from his peers, catches you and refuses to let go.  I think you will be here for a long, long time.");
  stop.motion(oEGO);
  set(f95);
  stop.cycling(oEGO);
  stop.motion(oLEPRECHAUN);
  stop.cycling(oLEPRECHAUN);
  set(fGAME_OVER);
}
if (fCARRYING_FIDDLE) {
  if (said("play", "fiddle")) {
    if (!fDANCING_LEPRECHAUNS) {
      print("You find playing the fiddle here very fun, but the dance floor is in the other room.");
    }
    else {
      print("You play a little tune on the fiddle to amuse yourself.");
    }
  }
}
if (said("examine", "throne")) {
  if (!f20 && !fDANCING_LEPRECHAUNS) {
    print("The King of the leprechauns is sitting on the stone throne.");
  }
  else {
    print("This is a rather simple stone throne, compared to King Edward's.");
  }
}
if (!fDANCING_LEPRECHAUNS && fCARRYING_CLOVER) {
  if (said("examine", "leprechauns")) {
    print("The little green men do not seem to be noticing you; perhaps because of the fourleaf clover.");
  }
  if (said("talk", "leprechauns") || said("hello") || said("say", "hello")) {
    print("I would not try talking to the leprechauns.  You might say the wrong thing.");
  }
  if (said("murder", "leprechauns")) {
    print("You would not get all of them before they got you.");
  }
}
if (!fDANCING_LEPRECHAUNS && !fCARRYING_CLOVER) {
  if (said("anyword", "leprechauns")) {
    print("The leprechauns seem irritated by your invasion of their territory.  I would be real careful about what I say and do right now!");
  }
}
if (fDANCING_LEPRECHAUNS) {
  if (said("anyword", "leprechauns")) {
    print("There aren't any leprechauns here.");
  }
}
if (!f187) {
  if (!f20) {
    if (said("examine", "king edward") || said("examine", "king edward", "leprechauns") || said("examine", "leprechauns", "king edward")) {
      if (!fSHIELD_TAKEN) {
        print("The King of the leprechauns is sitting on the stone throne. The magic shield is next to the throne.");
      }
      else {
        print("The King of the leprechauns is sitting on the stone throne.");
      }
    }
  }
  if (f20) {
    if (said("examine", "king edward") || said("examine", "king edward", "leprechauns") || said("examine", "leprechauns", "king edward")) {
      print("The King is leaving.");
    }
  }
  if (said("talk", "king edward") || said("hello") || said("say", "hello")) {
    print("The leprechaun King ignores your words.");
  }
}
if (f187) {
  if (said("anyword", "king edward")) {
    print("The King of the leprechauns is no longer here.");
  }
}
if (said("examine", "cave") || said("examine", "room")) {
  if (fSHIELD_TAKEN && fSCEPTRE_TAKEN) {
    print("This is the throne room of the leprechaun King.");
  }
  if (f20 || f187) {
    if (fSHIELD_TAKEN && !fSCEPTRE_TAKEN) {
      print("This is the throne room of the leprechaun King.  There is a sceptre next to the throne.");
    }
    if (!fSHIELD_TAKEN && !fSCEPTRE_TAKEN) {
      print("This is the throne room of the leprechaun King.  There is a shield and a sceptre near the throne.");
    }
  }
  if (!f20 && !f187) {
    if (!fSHIELD_TAKEN) {
      print("This is the throne room of the leprechaun King.  There is a shield next to the throne.");
    }
  }
}
if (said("examine", "stairway")) {
  if (posn(oEGO, 56, 10, 60, 156)) {
    print("The stairs go up a narrow tunnel.");
  }
  else {
    print("To see the stairs, you have to get closer.");
  }
}
if (!fCARRYING_SHIELD && fSHIELD_TAKEN) {
  if (said("examine", "shield")) {
    print("I think there might have been a shield here once, but someone has since taken it.");
  }
  if (said("get", "shield")) {
    print("The shield is no longer here.");
  }
}
if (!fSHIELD_TAKEN) {
  if (said("examine", "shield")) {
    if (posn(oEGO, 121, 118, 144, 138)) {
      print("It is made of titanium and is rimmed with jewels.");
    }
    else {
      print("You need to get closer to see it clearly.");
    }
  }
  if (said("get", "shield")) {
    if (posn(oEGO, 121, 118, 144, 138)) {
      erase(oSHIELD);
      if (fDANCING_LEPRECHAUNS) {
        print("You take the magic shield and carefully put it in your pocket.");
      }
      else {
        print("As inconspicuously as possible, you add the shield to what you are carrying.");
      }
      set(fSHIELD_TAKEN);
      set(fCARRYING_SHIELD);
      get("shield");
      vSCORE += 8;
      vTREASURE_COUNT++;
    }
    else {
      print("You must be closer to do that.");
    }
  }
}
if (fSCEPTRE_TAKEN && !fCARRYING_SCEPTRE) {
  if (said("examine", "sceptre")) {
    print("I see no sceptre in the vicinity.");
  }
  if (said("get", "sceptre")) {
    print("There is no sceptre in sight to get.");
  }
}
if (!fSCEPTRE_TAKEN) {
  if (posn(oEGO, 103, 100, 142, 142)) {
    if (f187 || f20) {
      if (said("examine", "sceptre")) {
        print("The sceptre is fashioned from gold and silver, and accented with emeralds.");
      }
      if (said("get", "sceptre")) {
        erase(oSCEPTRE);
        set(fSCEPTRE_TAKEN);
        set(fCARRYING_SCEPTRE);
        print("Eagerly, you pick up the sceptre.");
        get("sceptre");
        vSCORE += 6;
      }
    }
    if (!f187 && !f20) {
      if (said("examine", "sceptre")) {
        print("I see no sceptre right here.");
      }
      if (said("get", "sceptre")) {
        print("I see no sceptre to get around here.");
      }
    }
  }
  if (!posn(oEGO, 103, 100, 142, 142)) {
    if (said("examine", "sceptre") || said("get", "sceptre")) {
      print("You must be closer to do that.");
    }
  }
}
if (vEGO_EDGE_CODE != EDGE_NONE) {
  if (f20) {
    set(f187);
  }
}
if (vEGO_EDGE_CODE == EDGE_HORIZON) {
  new.room(76);
}
if (posn(oEGO, 0, 0, 1, 167)) {
  new.room(78);
}
return;

LOGIC__FOOTER

