#include "vars.txt"

LOGIC__HEADER

#define oMUSHROOM o1

if (fROOM_SCRIPT_EXECUTED) {
  load.pic(vROOM_NO);
  draw.pic(vROOM_NO);
  discard.pic(vROOM_NO);
  if (fGOAT_COMPANION) {
    load.logics(LOGIC_GOAT);
  }
  if (vROOM_YOU_KILLED_THE_GOAT_IN == vROOM_NO) {
    add.to.pic(62, 0, 0, 14, 144, 0, 0);
  }
  load.logics(LOGIC_SWIMMING);
  call(LOGIC_SWIMMING);
  if (!fMUSHROOM_TAKEN) {
    load.view(60);
    load.view(84);
    animate.obj(oMUSHROOM);
    set.view(oMUSHROOM, 84);
    position(oMUSHROOM, 84, 80);
    set(f20);
  }
  if (vPREV_ROOM_NO == 34) {
    if (posn(oEGO, 77, 165, 112, 167)) {
      position(oEGO, 71, 164);
    }
    if (posn(oEGO, 113, 165, 159, 167)) {
      position(oEGO, 142, 164);
    }
  }
  if (f20) {
    reset(f20);
    draw(oMUSHROOM);
  }
  set(f68);
  ignore.blocks(oEGO);
  draw(oEGO);
  show.pic();
}
if (fEGO_ON_WATER && !f21) {
  set(f21);
  print("This is sad.  You are not the first to fail your quest in the Raging River... I hope you may be the last.");
}
if (said("examine", "water")) {
  print("This is the wild Raging River filled with boulders and rapids.");
}
if (said("examine", "rocks")) {
  print("It would be dangerous to try and jump across the river on the boulders.");
}
if (said("examine", "across")) {
  if (posn(oEGO, 0, 0, 36, 111) || posn(oEGO, 0, 112, 97, 167)) {
    print("The land across the river looks enchanting.  You wonder how you can get there.");
  }
  else {
    print("You see the familiar side of the Raging River.");
  }
}
if (!fCARRYING_MUSHROOM && fMUSHROOM_TAKEN) {
  if (said("examine", "mushroom")) {
    print("There is no mushroom here.");
  }
}
if (fMUSHROOM_TAKEN) {
  if (said("examine", "ground")) {
    print("There is nothing of interest around you.");
  }
  if (said("get", "mushroom")) {
    if (fCARRYING_MUSHROOM) {
      print("You already have it.");
    }
    else {
      print("There is no mushroom here.");
    }
  }
}
if (!fMUSHROOM_TAKEN) {
  if (said("examine", "mushroom")) {
    if (posn(oEGO, 0, 0, 36, 111) || posn(oEGO, 0, 112, 97, 167)) {
      print("The mushroom is on the far side of the river.");
    }
    else if (posn(oEGO, 64, 61, 114, 101)) {
      print("This mushroom is large and aromatic.");
    }
    else {
      print("The colorful mushroom is in the distance.");
    }
  }
  if (said("examine", "ground")) {
    if (posn(oEGO, 0, 0, 36, 111) || posn(oEGO, 0, 112, 97, 167)) {
      print("There is nothing of interest around you.");
    }
    else if (posn(oEGO, 64, 61, 114, 101)) {
      print("There is a large mushroom growing in the ground close by.");
    }
    else {
      print("There is nothing of interest around you.");
    }
  }
  if (said("get", "mushroom")) {
    if (posn(oEGO, 0, 0, 36, 111) || posn(oEGO, 0, 112, 97, 167)) {
      print("The mushroom is on the far side of the river.");
    }
    else if (posn(oEGO, 74, 70, 94, 90)) {
      erase(oMUSHROOM);
      print("You reach down and pick a fat mushroom.");
      set(fMUSHROOM_TAKEN);
      set(fCARRYING_MUSHROOM);
      vSCORE += 1;
      get("mushroom");
    }
    else {
      print("You need to get closer to do that.");
    }
  }
}
if (said("examine", "building")) {
  print("You see King Edward's castle on the horizon.");
}
if (said("examine", "room")) {
  if (fMUSHROOM_TAKEN) {
    print("This lovely meadow is split by the Raging River.");
  }
  else {
    print("There is a large mushroom in the meadow next to the river.");
  }
}
if (v94 <= 0 && fEGO_ON_WATER) {
  v76 = 255;
  if (posn(oEGO, 7, 40, 62, 81)) {
    v76 = 23;
    v77 = 81;
  }
  if (posn(oEGO, 10, 82, 37, 116)) {
    v76 = 28;
    v77 = 95;
  }
  if (posn(oEGO, 37, 82, 74, 90)) {
    v76 = 60;
    v77 = 104;
  }
  if (posn(oEGO, 64, 91, 104, 116)) {
    v76 = 74;
    v77 = 116;
  }
  if (posn(oEGO, 37, 117, 100, 145)) {
    v76 = 70;
    v77 = 117;
  }
  if (posn(oEGO, 68, 146, 111, 167) || posn(oEGO, 101, 117, 143, 167)) {
    v76 = 102;
    v77 = 155;
  }
  if (v76 == 255) {
    v76 = 0;
  }
  else {
    get.posn(oEGO, vTEMP_X, vTEMP_Y);
    v76 -= vTEMP_X;
    v77 -= vTEMP_Y;
    set(f134);
  }
}
if (!fBUCKET_FILLED && !fEGO_ON_WATER && !f116) {
  if (said("drink", "water") || said("get", "drink")) {
    if (posn(oEGO, 0, 40, 32, 111) || posn(oEGO, 14, 112, 88, 135) || posn(oEGO, 39, 136, 99, 167) || posn(oEGO, 36, 40, 74, 76) || posn(oEGO, 46, 77, 101, 88) || posn(oEGO, 68, 89, 151, 167)) {
      print("The water from this swift river is cold and sweet.");
    }
    else {
      print("You need to get closer to do that.");
    }
  }
}
if (!fBUCKET_FILLED && fCARRYING_BUCKET && !fEGO_ON_WATER && said("get", "water")) {
  if (posn(oEGO, 0, 40, 32, 111) || posn(oEGO, 14, 112, 88, 135) || posn(oEGO, 39, 136, 99, 167) || posn(oEGO, 36, 40, 74, 76) || posn(oEGO, 46, 77, 101, 88) || posn(oEGO, 68, 89, 151, 167)) {
    reset(f116);
    print("The river is so swift it is a battle to fill the bucket.");
    get("water");
    set(fBUCKET_FILLED);
    if (!fFILL_BUCKET_POINTS) {
      vSCORE += 2;
    }
    set(fFILL_BUCKET_POINTS);
  }
  else {
    print("You need to get closer to do that.");
  }
}
if (vEGO_EDGE_CODE == EDGE_RIGHT) {
  new.room(48);
}
if (vEGO_EDGE_CODE == EDGE_LEFT) {
  new.room(46);
}
if (vEGO_EDGE_CODE == EDGE_BOTTOM) {
  new.room(34);
}
if (fGOAT_COMPANION) {
  call(LOGIC_GOAT);
}
call(LOGIC_SWIMMING);
return;

LOGIC__FOOTER

