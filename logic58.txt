#include "vars.txt"

LOGIC__HEADER

#define oGIANT o1
#define oCHEST o2
#define oFLUNG_PEBBLE o15

if (fROOM_SCRIPT_EXECUTED) {
  ignore.horizon(oEGO);
  load.pic(vROOM_NO);
  draw.pic(vROOM_NO);
  discard.pic(vROOM_NO);
  load.view(105);
  load.view(114);
  load.sound(SND_VILLAIN);
  load.sound(SND_FALLING);
  load.sound(SND_GIANT);
  load.sound(SND_KILL_GIANT);
  v33 = 0;
  if (fCARRYING_SLINGSHOT) {
    load.view(102);
    animate.obj(oFLUNG_PEBBLE);
    set.view(oFLUNG_PEBBLE, 102);
  }
  if (!fCARRYING_CHEST && !f169) {
    load.view(37);
    animate.obj(oCHEST);
    set.view(oCHEST, 37);
    load.view(36);
    load.view(52);
    load.view(68);
    load.view(77);
  }
  if (fCARRYING_CHEST || f169) {
    load.view(68);
    load.view(66);
    load.view(77);
  }
  if (vGIANT_STATE == GIANTSTATE_AWAKE_WITH_CHEST) {
    animate.obj(oGIANT);
    set.view(oGIANT, 36);
    position(oGIANT, 91, 71);
    follow.ego(oGIANT, 10, f22);
    set(f23);
    v30 = 250;
    v31 = 2;
  }
  if (vGIANT_STATE == GIANTSTATE_AWAKE_NO_CHEST) {
    animate.obj(oGIANT);
    set.view(oGIANT, 66);
    position(oGIANT, 91, 71);
    follow.ego(oGIANT, 10, f22);
    set(f23);
  }
  if (vGIANT_STATE == GIANTSTATE_DEAD_WITH_CHEST) {
    animate.obj(oGIANT);
    set.view(oGIANT, 77);
    position(oGIANT, 73, 113);
    set.cel(oGIANT, 3);
    stop.cycling(oGIANT);
    step.size(oGIANT, v33);
    animate.obj(oCHEST);
    set.view(oCHEST, 37);
    position(oCHEST, 75, 114);
    draw(oCHEST);
  }
  if (vGIANT_STATE == GIANTSTATE_DEAD_NO_CHEST) {
    animate.obj(oGIANT);
    set.view(oGIANT, 77);
    position(oGIANT, 73, 113);
    set.cel(oGIANT, 3);
    stop.cycling(oGIANT);
    step.size(oGIANT, v33);
  }
  draw(oGIANT);
  draw(oEGO);
  show.pic();
}
if (vGIANT_STATE == GIANTSTATE_AWAKE_WITH_CHEST || vGIANT_STATE == GIANTSTATE_AWAKE_NO_CHEST) {
  if (!f26) {
    set(f26);
    sound(SND_VILLAIN, f148);
  }
}
if (f22 && f23) {
  if (fEGO_INVISIBLE) {
    reset(f22);
    reset(f23);
    print("The giant cannot see you since you are invisible.");
    wander(oGIANT);
  }
  else if (fCARRYING_SHIELD) {
    reset(f22);
    reset(f23);
    print("You are fortunate that you have the magic shield or this giant would cause problems for you.");
    wander(oGIANT);
  }
  else if (fPROTECTED_BY_SPELL) {
    reset(f22);
    reset(f23);
    print("The fairy godmother's spell is protecting you.");
    wander(oGIANT);
  }
  else if (!fCARRYING_SHIELD && !fEGO_INVISIBLE && !fPROTECTED_BY_SPELL) {
    if (vGIANT_STATE == GIANTSTATE_AWAKE_WITH_CHEST || vGIANT_STATE == GIANTSTATE_AWAKE_NO_CHEST) {
      reset(f22);
      reset(f23);
      set.view(oEGO, 114);
      print("Be a little more careful next time.  This giant is mean!");
      wander(oGIANT);
      set(fGAME_OVER);
    }
  }
}
if (fEGO_TOUCHED_TRIGGER_LINE) {
  set(f199);
  reset(fEGO_TOUCHED_TRIGGER_LINE);
  program.control();
  if (!fEGO_INVISIBLE) {
    set.view(oEGO, 105);
  }
  start.cycling(oEGO);
  set(f98);
  sound(SND_FALLING, fSOUND_END_MARKER);
  erase(oEGO);
}
if (fSOUND_END_MARKER) {
  reset(fSOUND_END_MARKER);
  set(f20);
}
if (f20) {
  reset(f20);
  print("You know you can't walk on clouds.");
  set(fGAME_OVER);
}
if (said("examine", "giant")) {
  if (vGIANT_STATE == GIANTSTATE_AWAKE_NO_CHEST) {
    print("The giant is enormous!  He does look rather stupid, though.");
  }
  if (vGIANT_STATE == GIANTSTATE_AWAKE_WITH_CHEST) {
    print("The enormous giant has been carrying that heavy chest for longer than he can remember.");
  }
  if (vGIANT_STATE == GIANTSTATE_ASLEEP_WITH_CHEST) {
    print("The giant is sleeping with a chest.");
  }
  if (vGIANT_STATE == GIANTSTATE_ASLEEP_NO_CHEST) {
    print("The huge giant has fallen asleep and is now snoring loudly.");
  }
  if (vGIANT_STATE == GIANTSTATE_DEAD_WITH_CHEST) {
    print("The giant lies dead on the ground and there is a chest beside him.");
  }
  if (vGIANT_STATE == GIANTSTATE_DEAD_NO_CHEST) {
    print("The giant has been slain by a little pebble to the forehead.");
  }
}
if (said("talk", "giant") || said("hello") || said("say", "hello")) {
  if (vGIANT_STATE == GIANTSTATE_AWAKE_NO_CHEST || vGIANT_STATE == GIANTSTATE_AWAKE_WITH_CHEST) {
    print("The giant is in no mood for talking.");
  }
  if (vGIANT_STATE == GIANTSTATE_ASLEEP_WITH_CHEST || vGIANT_STATE == GIANTSTATE_ASLEEP_NO_CHEST) {
    print("It is not a good idea to wake a sleeping giant.");
  }
  if (vGIANT_STATE == GIANTSTATE_DEAD_WITH_CHEST || vGIANT_STATE == GIANTSTATE_DEAD_NO_CHEST) {
    print("A dead giant does not have a lot to say.");
  }
}
if (!fCARRYING_CHEST && !f169) {
  if (said("examine", "chest")) {
    print("The magic chest appears to have been fashioned from ebony and rimmed on the edges with gold.");
  }
}
if (!fCARRYING_CHEST) {
  if (said("get", "chest") || said("get", "chest", "giant")) {
    if (vGIANT_STATE == GIANTSTATE_AWAKE_WITH_CHEST) {
      print("The giant is protecting the magic chest.");
    }
    if (f169) {
      print("There is no chest around here to get.");
    }
    distance(oEGO, oGIANT, v70);
    if (vGIANT_STATE == GIANTSTATE_ASLEEP_WITH_CHEST) {
      if (v70 > 30) {
        print("There is no way you can get the chest from here!");
      }
      else {
        erase(oGIANT);
        set.view(oGIANT, 68);
        stop.motion(oGIANT);
        draw(oGIANT);
        print("Very carefully, you slip the magic chest from the sleeping giant's arms.");
        set(fCARRYING_CHEST);
        set(f169);
        vSCORE += 8;
        get("chest");
        vTREASURE_COUNT++;
        vGIANT_STATE = GIANTSTATE_ASLEEP_NO_CHEST;
      }
    }
    distance(oEGO, oCHEST, v62);
    if (vGIANT_STATE == GIANTSTATE_DEAD_WITH_CHEST) {
      if (v62 > 30) {
        print("There is no way you can get the chest from here!");
      }
      else {
        erase(oCHEST);
        print("It's easy to take a magic chest from a dead giant.");
        set(fCARRYING_CHEST);
        set(f169);
        vSCORE += 8;
        get("chest");
        vTREASURE_COUNT++;
        vGIANT_STATE = GIANTSTATE_DEAD_NO_CHEST;
      }
    }
  }
}
if (fCARRYING_SLINGSHOT) {
  distance(oEGO, oGIANT, v71);
  if (said("use", "slingshot") || said("with", "slingshot")) {
    if (!fCARRYING_PEBBLES) {
      print("You need some kind of small rock to use the sling.");
    }
    if (fCARRYING_PEBBLES && v71 < 20) {
      print("There is no way you can get the chest from here!");
    }
    if (fCARRYING_PEBBLES
      && !f169
      && !fEGO_INVISIBLE
      && vGIANT_STATE == GIANTSTATE_AWAKE_WITH_CHEST
      && v71 > 19
      && !f199
    ) {
      reset(f23);
      get.posn(oEGO, vTEMP_X_2, vTEMP_Y_2);
      position.v(oFLUNG_PEBBLE, vTEMP_X_2, vTEMP_Y_2);
      erase(oEGO);
      draw(oFLUNG_PEBBLE);
      sound(SND_KILL_GIANT, f148);
      end.of.loop(oFLUNG_PEBBLE, f24);
      print("You put the pebble in the sling, take careful aim, and luckily hit the giant in the forehead!  He falls down dead.");
      reset(fCARRYING_PEBBLES);
      drop("pebbles");
      vSCORE -= 1;
    }
    if (fCARRYING_PEBBLES
      && f169
      && !fEGO_INVISIBLE
      && vGIANT_STATE == GIANTSTATE_AWAKE_NO_CHEST
      && v71 > 19
    ) {
      reset(f23);
      get.posn(oEGO, vTEMP_X_2, vTEMP_Y_2);
      position.v(oFLUNG_PEBBLE, vTEMP_X_2, vTEMP_Y_2);
      erase(oEGO);
      draw(oFLUNG_PEBBLE);
      sound(SND_KILL_GIANT, f148);
      end.of.loop(oFLUNG_PEBBLE, f25);
      print("You put the pebble in the sling, take careful aim, and luckily hit the giant in the forehead!  He falls down dead.");
      reset(fCARRYING_PEBBLES);
      drop("pebbles");
      vSCORE -= 1;
    }
    if (fCARRYING_PEBBLES && !f169 && fEGO_INVISIBLE) {
      if (vGIANT_STATE == GIANTSTATE_AWAKE_WITH_CHEST
        || vGIANT_STATE == GIANTSTATE_AWAKE_NO_CHEST
      ) {
        print("Not when you're invisible!");
      }
    }
    if (fCARRYING_PEBBLES) {
      if (vGIANT_STATE == GIANTSTATE_ASLEEP_WITH_CHEST
        || vGIANT_STATE == GIANTSTATE_ASLEEP_NO_CHEST
      ) {
        print("It would be rather cowardly of you to kill a giant while he is asleep!");
      }
    }
  }
}
if (f24) {
  reset(f24);
  erase(oFLUNG_PEBBLE);
  set.view(oEGO, 0);
  position.v(oEGO, vTEMP_X_2, vTEMP_Y_2);
  draw(oEGO);
  erase(oGIANT);
  set.view(oGIANT, 77);
  step.size(oGIANT, v33);
  draw(oGIANT);
  end.of.loop(oGIANT, f148);
  get.posn(oGIANT, vTEMP_X, vTEMP_Y);
  position.v(oCHEST, vTEMP_X, vTEMP_Y);
  draw(oCHEST);
  vGIANT_STATE = GIANTSTATE_DEAD_WITH_CHEST;
  vSCORE += 3;
}
if (f25) {
  reset(f25);
  erase(oFLUNG_PEBBLE);
  set.view(oEGO, 0);
  position.v(oEGO, vTEMP_X_2, vTEMP_Y_2);
  draw(oEGO);
  erase(oGIANT);
  set.view(oGIANT, 77);
  step.size(oGIANT, v33);
  draw(oGIANT);
  end.of.loop(oGIANT, f148);
  vGIANT_STATE = GIANTSTATE_DEAD_NO_CHEST;
}
if (fCARRYING_DAGGER) {
  if (said("use", "dagger") || said("throw", "dagger")) {
    reset(fCARRYING_DAGGER);
    drop("dagger");
    print("I don't believe it!  How could you miss something so big?");
    vSCORE -= 5;
  }
}
if (said("murder", "giant")) {
  if (vGIANT_STATE == GIANTSTATE_AWAKE_WITH_CHEST) {
    print("How?");
  }
  if (vGIANT_STATE == GIANTSTATE_AWAKE_NO_CHEST) {
    print("There is no reason to kill the giant.");
  }
  if (vGIANT_STATE == GIANTSTATE_ASLEEP_WITH_CHEST || vGIANT_STATE == GIANTSTATE_ASLEEP_NO_CHEST) {
    print("It would be rather cowardly of you to kill a giant while he is asleep!");
  }
  if (vGIANT_STATE == GIANTSTATE_DEAD_WITH_CHEST || vGIANT_STATE == GIANTSTATE_DEAD_NO_CHEST) {
    print("The giant has been slain by a little pebble to the forehead.");
  }
}
if (said("examine", "room") || said("examine", "clouds")) {
  print("You are in the Land of the Clouds.  It is rumored that a giant lives up here.");
}
if (vGIANT_STATE == GIANTSTATE_AWAKE_WITH_CHEST) {
  v30--;
  if (v30 == 0) {
    if (v31 != 0) {
      v31--;
      v30 = 250;
    }
  }
}
if (v30 == 1 && v31 == 0) {
  reset(f23);
  v30 = 0;
  stop.motion(oGIANT);
  erase(oGIANT);
  set.view(oGIANT, 52);
  step.size(oGIANT, v33);
  draw(oGIANT);
  vGIANT_STATE = GIANTSTATE_ASLEEP_WITH_CHEST;
  if (!f205) {
    set(f205);
    vSCORE += 7;
  }
  print("What luck!  The huge giant fell fast asleep!");
}
if (vGIANT_STATE == GIANTSTATE_ASLEEP_WITH_CHEST || vGIANT_STATE == GIANTSTATE_ASLEEP_NO_CHEST) {
  if (!f28) {
    set(f28);
    sound(SND_GIANT, f27);
  }
  if (f27) {
    reset(f27);
    reset(f28);
  }
}
if (fGAME_OVER) {
  return;
}
if (vEGO_EDGE_CODE != EDGE_NONE) {
  if (vGIANT_STATE == GIANTSTATE_ASLEEP_WITH_CHEST) {
    vGIANT_STATE = GIANTSTATE_AWAKE_WITH_CHEST;
  }
  if (vGIANT_STATE == GIANTSTATE_ASLEEP_NO_CHEST) {
    vGIANT_STATE = GIANTSTATE_AWAKE_NO_CHEST;
  }
}
if (vEGO_EDGE_CODE == EDGE_RIGHT) {
  new.room(ROOM59);
}
if (vEGO_EDGE_CODE == EDGE_LEFT) {
  new.room(ROOM57);
}
if (vEGO_EDGE_CODE == EDGE_BOTTOM) {
  new.room(ROOM61);
}
return;

LOGIC__FOOTER

