#include "vars.txt"

LOGIC__HEADER

#define oDOOR o1


if (fROOM_SCRIPT_EXECUTED) {
  load.pic(vROOM_NO);
  draw.pic(vROOM_NO);
  discard.pic(vROOM_NO);
  set.horizon(41);
  if (fGOAT_IS_HERE) {
    load.logics(LOGIC_GOAT);
  }
  if (vROOM_YOU_KILLED_THE_GOAT_IN == vROOM_NO) {
    add.to.pic(62, 0, 0, 27, 127, 0, 0);
  }
  LABEL37:
    load.view(20);
    animate.obj(oDOOR);
    set.view(oDOOR, 20);
    set.priority(oDOOR, 8);
    position(oDOOR, 101, 92);
    load.sound(19);
    if (vPREV_ROOM_NO == 66) {
      position(oEGO, 102, 98);
      vDOOR_STATE = DOORSTATE_OPEN;
    }
  LABEL67:
    if (vDOOR_STATE == DOORSTATE_OPEN) {
      set.cel(oDOOR, 3);
      draw(oDOOR);
      ignore.objs(oDOOR);
      ignore.blocks(oEGO);
      stop.update(oDOOR);
    }
  LABEL85:
    if (vDOOR_STATE == DOORSTATE_LOCKED || vDOOR_STATE == DOORSTATE_CLOSED) {
      set.cel(oDOOR, 0);
      draw(oDOOR);
      observe.objs(oDOOR);
      observe.blocks(oEGO);
      stop.update(oDOOR);
    }
  LABEL108:
    draw(oEGO);
    show.pic();
}
if (said("examine", "mountains")) {
  print("There seems to be a door built into the mountainside.");
}
LABEL123:
  if (said("climb", "mountains")) {
    print(null);
  }
LABEL135:
  if (said("examine", "doors")) {
    if (posn(oEGO, 90, 93, 125, 114)) {
      print("It is a huge wooden door built right into the bottom of a small mountain!  It has a large keyhole.");
      goto(LABEL162);
    }
    print("Don't be afraid.  Get close enough for a good look.");
  }
LABEL162:
  if (said("break", "doors")) {
    if (posn(oEGO, 90, 93, 125, 114)) {
      print("You strike the door with all your might!  To no avail.");
      goto(LABEL189);
    }
    print("It will be difficult to do that from here.");
  }
LABEL189:
  if (!posn(oEGO, 90, 93, 125, 114)) {
    if (said("open", "doors") || said("close", "doors") || said("turn", "knob") || said("open", "doors", "gold key") || said("open", "doors", "golden", "gold key")) {
      print("It will be difficult to do that from here.");
    }
    if (fCARRYING_GOLD_KEY) {
      if (said("use", "gold key") || said("lock", "doors") || said("unlock", "doors")) {
        print("It will be difficult to do that from here.");
      }
    }
  }
LABEL276:
  if (posn(oEGO, 90, 93, 125, 114)) {
    if (fCARRYING_GOLD_KEY) {
      if (said("use", "gold key")) {
        print("How do you want to use the key?");
      }
      if (said("unlock", "doors") || said("unlock", "doors", "gold key") || said("unlock", "doors", "golden", "gold key") || said("open", "doors", "gold key") || said("open", "doors", "golden", "gold key")) {
        if (vDOOR_STATE == DOORSTATE_CLOSED) {
          print("The door is already unlocked.");
        }
        if (vDOOR_STATE == DOORSTATE_OPEN) {
          print("There is no need to unlock an already open door.");
        }
        LABEL370:
          if (vDOOR_STATE == DOORSTATE_LOCKED) {
            print("Using the gold key, you unlock the huge door.");
            vDOOR_STATE = DOORSTATE_CLOSED;
            if (!fPOINTS_FOR_UNLOCKING_DOOR) {
              set(fPOINTS_FOR_UNLOCKING_DOOR);
              vSCORE += 2;
            }
          }
      }
      LABEL394:
        if (said("lock", "doors")) {
          if (vDOOR_STATE == DOORSTATE_LOCKED) {
            print("The door is already locked.");
          }
          if (vDOOR_STATE == DOORSTATE_CLOSED) {
            print("You lock the massive door with the heavy gold key.");
            vDOOR_STATE = DOORSTATE_LOCKED;
          }
          LABEL425:
            if (vDOOR_STATE == DOORSTATE_OPEN) {
              print("You need to close the door before you can lock it.");
            }
        }
    }
    LABEL434:
      if (vDOOR_STATE == DOORSTATE_LOCKED) {
        if (said("open", "doors") || said("turn", "knob")) {
          print("This massive door is securely locked.");
        }
      }
    LABEL461:
      if (vDOOR_STATE == DOORSTATE_OPEN) {
        if (said("open", "doors") || said("turn", "knob")) {
          print("The door is already open.");
        }
      }
    LABEL488:
      if (vDOOR_STATE == DOORSTATE_CLOSED) {
        if (said("open", "doors") || said("turn", "knob")) {
          start.update(oDOOR);
          sound(19, f148);
          end.of.loop(oDOOR, f20);
          vDOOR_STATE = DOORSTATE_OPEN;
        }
      }
    LABEL524:
      if (said("close", "doors")) {
        if (vDOOR_STATE == DOORSTATE_LOCKED || vDOOR_STATE == DOORSTATE_CLOSED) {
          print();
        }
        if (vDOOR_STATE == DOORSTATE_OPEN) {
          start.update(oDOOR);
          reverse.loop(oDOOR, f21);
          vDOOR_STATE = DOORSTATE_CLOSED;
        }
      }
  }
LABEL563:
  if (f20) {
    reset(f20);
    ignore.objs(oDOOR);
    ignore.blocks(oEGO);
    stop.update(oDOOR);
  }
LABEL577:
  if (f21) {
    reset(f21);
    observe.objs(oDOOR);
    observe.blocks(oEGO);
    stop.update(oDOOR);
  }
LABEL591:
  if (!fCARRYING_GOLD_KEY) {
    if (said("use", "gold key")) {
      print("You can't fool me!  You don't have a key.");
    }
    if (said("unlock", "doors")) {
      print("You can't unlock the door without a key.");
    }
    LABEL622:
      if (said("lock", "doors")) {
        print("You need a key to do that.");
      }
  }
LABEL634:
  if (said("examine", "key hole")) {
    if (posn(oEGO, 90, 93, 125, 114)) {
      print("Through the keyhole you can dimly see a staircase. It looks like it might go up into the mountain.");
      goto(LABEL661);
    }
    print("There aren't many keyholes in the ground here.");
  }
LABEL661:
  if (posn(oEGO, 99, 93, 114, 94)) {
    new.room(66);
  }
LABEL673:
  if (vEGO_EDGE_CODE == 1) {
    new.room(30);
  }
LABEL682:
  if (vEGO_EDGE_CODE == 2) {
    new.room(18);
  }
LABEL691:
  if (vEGO_EDGE_CODE == 4) {
    new.room(20);
  }
LABEL700:
  if (vEGO_EDGE_CODE == 3) {
    new.room(14);
  }
LABEL709:
  if (fGOAT_IS_HERE) {
    call(LOGIC_GOAT);
  }
LABEL717:
  return;

LOGIC__FOOTER

